{
  "hash": "aeb5bc62f3bcf80e08dc0ba2a7294202",
  "result": {
    "markdown": "---\ntitle: \"Challenge4\"\nauthor: \"Danny Cam Hoa Tien\"\ndate: \"2023-05-23\"\noutput: html_document\n---\n\n\n\n\n## R Markdown\n\nThis is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.\n\nWhen you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-1_de8c510d1f138c217f31d2883a13eaee'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.2     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.1     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\n\n# libraries\nlibrary(rsample)\nlibrary(recipes)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attache Paket: 'recipes'\n#> \n#> Das folgende Objekt ist maskiert 'package:stringr':\n#> \n#>     fixed\n#> \n#> Das folgende Objekt ist maskiert 'package:stats':\n#> \n#>     step\n```\n:::\n\n```{.r .cell-code}\nlibrary(PerformanceAnalytics)  # for skewness \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Lade nötiges Paket: xts\n#> Lade nötiges Paket: zoo\n#> \n#> Attache Paket: 'zoo'\n#> \n#> Die folgenden Objekte sind maskiert von 'package:base':\n#> \n#>     as.Date, as.Date.numeric\n#> \n#> \n#> ######################### Warning from 'xts' package ##########################\n#> #                                                                             #\n#> # The dplyr lag() function breaks how base R's lag() function is supposed to  #\n#> # work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or       #\n#> # source() into this session won't work correctly.                            #\n#> #                                                                             #\n#> # Use stats::lag() to make sure you're not using dplyr::lag(), or you can add #\n#> # conflictRules('dplyr', exclude = 'lag') to your .Rprofile to stop           #\n#> # dplyr from breaking base R's lag() function.                                #\n#> #                                                                             #\n#> # Code in packages is not affected. It's protected by R's namespace mechanism #\n#> # Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #\n#> #                                                                             #\n#> ###############################################################################\n#> \n#> Attache Paket: 'xts'\n#> \n#> Die folgenden Objekte sind maskiert von 'package:dplyr':\n#> \n#>     first, last\n#> \n#> \n#> Attache Paket: 'PerformanceAnalytics'\n#> \n#> Das folgende Objekt ist maskiert 'package:graphics':\n#> \n#>     legend\n```\n:::\n\n```{.r .cell-code}\n# H2O modeling\nlibrary(h2o)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> ----------------------------------------------------------------------\n#> \n#> Your next step is to start H2O:\n#>     > h2o.init()\n#> \n#> For H2O package documentation, ask for help:\n#>     > ??h2o\n#> \n#> After starting H2O, you can use the Web UI at http://localhost:54321\n#> For more information visit https://docs.h2o.ai\n#> \n#> ----------------------------------------------------------------------\n#> \n#> \n#> Attache Paket: 'h2o'\n#> \n#> Die folgenden Objekte sind maskiert von 'package:lubridate':\n#> \n#>     day, hour, month, week, year\n#> \n#> Die folgenden Objekte sind maskiert von 'package:stats':\n#> \n#>     cor, sd, var\n#> \n#> Die folgenden Objekte sind maskiert von 'package:base':\n#> \n#>     %*%, %in%, &&, ||, apply, as.factor, as.numeric, colnames,\n#>     colnames<-, ifelse, is.character, is.factor, is.numeric, log,\n#>     log10, log1p, log2, round, signif, trunc\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-2_bf5887fee5f08cf976a0b192c29da59b'}\n\n```{.r .cell-code}\n# Load data\n\nemployee_attrition_tbl <- read_csv(\"datasets-1067-1925-WA_Fn-UseC_-HR-Employee-Attrition.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Rows: 1470 Columns: 35\n#> ── Column specification ────────────────────────────────────────────────────────\n#> Delimiter: \",\"\n#> chr  (9): Attrition, BusinessTravel, Department, EducationField, Gender, Job...\n#> dbl (26): Age, DailyRate, DistanceFromHome, Education, EmployeeCount, Employ...\n#> \n#> ℹ Use `spec()` to retrieve the full column specification for this data.\n#> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\ndefinitions_raw_tbl    <- read_excel(\"data_definitions.xlsx\", sheet = 1, col_names = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> New names:\n#> • `` -> `...1`\n#> • `` -> `...2`\n```\n:::\n\n```{.r .cell-code}\nView(definitions_raw_tbl)\n```\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-3_9a1349a18b0b374b287c35b40dff5fe2'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>% \n        ggplot(aes(Education)) +\n        geom_bar()\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n# Data preparation ----\n# Human readable\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-4_82e513beaa1bb5ad8fb81ed5983c6b7b'}\n\n```{.r .cell-code}\ndefinitions_tbl <- definitions_raw_tbl %>% \n  fill(...1, .direction = \"down\") %>%\n  filter(!is.na(...2)) %>%\n  separate(...2, into = c(\"key\", \"value\"), sep = \" '\", remove = TRUE) %>%\n  rename(column_name = ...1) %>%\n  mutate(key = as.numeric(key)) %>%\n  mutate(value = value %>% str_replace(pattern = \"'\", replacement = \"\")) \ndefinitions_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"column_name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"key\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"value\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Education\",\"2\":\"1\",\"3\":\"Below College\"},{\"1\":\"Education\",\"2\":\"2\",\"3\":\"College\"},{\"1\":\"Education\",\"2\":\"3\",\"3\":\"Bachelor\"},{\"1\":\"Education\",\"2\":\"4\",\"3\":\"Master\"},{\"1\":\"Education\",\"2\":\"5\",\"3\":\"Doctor\"},{\"1\":\"EnvironmentSatisfaction\",\"2\":\"1\",\"3\":\"Low\"},{\"1\":\"EnvironmentSatisfaction\",\"2\":\"2\",\"3\":\"Medium\"},{\"1\":\"EnvironmentSatisfaction\",\"2\":\"3\",\"3\":\"High\"},{\"1\":\"EnvironmentSatisfaction\",\"2\":\"4\",\"3\":\"Very High\"},{\"1\":\"JobInvolvement\",\"2\":\"1\",\"3\":\"Low\"},{\"1\":\"JobInvolvement\",\"2\":\"2\",\"3\":\"Medium\"},{\"1\":\"JobInvolvement\",\"2\":\"3\",\"3\":\"High\"},{\"1\":\"JobInvolvement\",\"2\":\"4\",\"3\":\"Very High\"},{\"1\":\"JobSatisfaction\",\"2\":\"1\",\"3\":\"Low\"},{\"1\":\"JobSatisfaction\",\"2\":\"2\",\"3\":\"Medium\"},{\"1\":\"JobSatisfaction\",\"2\":\"3\",\"3\":\"High\"},{\"1\":\"JobSatisfaction\",\"2\":\"4\",\"3\":\"Very High\"},{\"1\":\"PerformanceRating\",\"2\":\"1\",\"3\":\"Low\"},{\"1\":\"PerformanceRating\",\"2\":\"2\",\"3\":\"Good\"},{\"1\":\"PerformanceRating\",\"2\":\"3\",\"3\":\"Excellent\"},{\"1\":\"PerformanceRating\",\"2\":\"4\",\"3\":\"Outstanding\"},{\"1\":\"RelationshipSatisfaction\",\"2\":\"1\",\"3\":\"Low\"},{\"1\":\"RelationshipSatisfaction\",\"2\":\"2\",\"3\":\"Medium\"},{\"1\":\"RelationshipSatisfaction\",\"2\":\"3\",\"3\":\"High\"},{\"1\":\"RelationshipSatisfaction\",\"2\":\"4\",\"3\":\"Very High\"},{\"1\":\"WorkLifeBalance\",\"2\":\"1\",\"3\":\"Bad\"},{\"1\":\"WorkLifeBalance\",\"2\":\"2\",\"3\":\"Good\"},{\"1\":\"WorkLifeBalance\",\"2\":\"3\",\"3\":\"Better\"},{\"1\":\"WorkLifeBalance\",\"2\":\"4\",\"3\":\"Best\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n# DATA PREPARATION ----\n# Human readable ----\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-5_4a49020c024235ee0dd3c7dbf5182f55'}\n\n```{.r .cell-code}\ndefinitions_list <- definitions_tbl %>% \n  \n  # Mapping over lists\n  \n  # Split into multiple tibbles\n  split(.$column_name) %>%\n  # Remove column_name\n  map(~ select(., -column_name)) %>%\n  # Convert to factors because they are ordered an we want to maintain that order\n  map(~ mutate(., value = as_factor(value))) \n  \n# definitions_list[[1]]\ndefinitions_list[[\"Education\"]]\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"key\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"value\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Below College\"},{\"1\":\"2\",\"2\":\"College\"},{\"1\":\"3\",\"2\":\"Bachelor\"},{\"1\":\"4\",\"2\":\"Master\"},{\"1\":\"5\",\"2\":\"Doctor\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n# Rename columns\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-6_fc8fe79dda7a1a3dd85f4a3c973d6c01'}\n\n```{.r .cell-code}\nfor (i in seq_along(definitions_list)) {\n  list_name <- names(definitions_list)[i]\n  colnames(definitions_list[[i]]) <- c(list_name, paste0(list_name, \"_value\"))\n}\n\ndefinitions_list[[\"Education\"]]\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Education\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Education_value\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Below College\"},{\"1\":\"2\",\"2\":\"College\"},{\"1\":\"3\",\"2\":\"Bachelor\"},{\"1\":\"4\",\"2\":\"Master\"},{\"1\":\"5\",\"2\":\"Doctor\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-7_5266a1c0a68eb89d1af261ad443a2c07'}\n\n```{.r .cell-code}\ndata_merged_tbl <- list(HR_Data = employee_attrition_tbl) %>%\n    \n        # Join everything\n        append(definitions_list, after = 1) %>%\n        reduce(left_join) %>%\n        \n        # Remove unnecessary columns\n        select(-one_of(names(definitions_list))) %>%\n        \n        # Format the \"_value\"\n        set_names(str_replace_all(names(.), pattern = \"_value\", replacement = \"\")) %>%\n        \n        # Resort\n        select(sort(names(.))) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Joining with `by = join_by(Education)`\n#> Joining with `by = join_by(EnvironmentSatisfaction)`\n#> Joining with `by = join_by(JobInvolvement)`\n#> Joining with `by = join_by(JobSatisfaction)`\n#> Joining with `by = join_by(PerformanceRating)`\n#> Joining with `by = join_by(RelationshipSatisfaction)`\n#> Joining with `by = join_by(WorkLifeBalance)`\n```\n:::\n:::\n\n# Return only unique values of BusinessTravel\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-8_3d183d2f14afbc5ca5ca501e122defb4'}\n\n```{.r .cell-code}\ndata_merged_tbl %>% \n  distinct(BusinessTravel)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"BusinessTravel\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Travel_Rarely\"},{\"1\":\"Travel_Frequently\"},{\"1\":\"Non-Travel\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n# Mutate To Factors\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-9_a91d8e76a367803b2b70e4396916f022'}\n\n```{.r .cell-code}\ndata_merged_tbl %>%\n        mutate_if(is.character, as.factor) %>%\n        glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 1,470\n#> Columns: 35\n#> $ Age                      <dbl> 41, 49, 37, 33, 27, 32, 59, 30, 38, 36, 35, 2…\n#> $ Attrition                <fct> Yes, No, Yes, No, No, No, No, No, No, No, No,…\n#> $ BusinessTravel           <fct> Travel_Rarely, Travel_Frequently, Travel_Rare…\n#> $ DailyRate                <dbl> 1102, 279, 1373, 1392, 591, 1005, 1324, 1358,…\n#> $ Department               <fct> Sales, Research & Development, Research & Dev…\n#> $ DistanceFromHome         <dbl> 1, 8, 2, 3, 2, 2, 3, 24, 23, 27, 16, 15, 26, …\n#> $ Education                <fct> College, Below College, College, Master, Belo…\n#> $ EducationField           <fct> Life Sciences, Life Sciences, Other, Life Sci…\n#> $ EmployeeCount            <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n#> $ EmployeeNumber           <dbl> 1, 2, 4, 5, 7, 8, 10, 11, 12, 13, 14, 15, 16,…\n#> $ EnvironmentSatisfaction  <fct> Medium, High, Very High, Very High, Low, Very…\n#> $ Gender                   <fct> Female, Male, Male, Female, Male, Male, Femal…\n#> $ HourlyRate               <dbl> 94, 61, 92, 56, 40, 79, 81, 67, 44, 94, 84, 4…\n#> $ JobInvolvement           <fct> High, Medium, Medium, High, High, High, Very …\n#> $ JobLevel                 <dbl> 2, 2, 1, 1, 1, 1, 1, 1, 3, 2, 1, 2, 1, 1, 1, …\n#> $ JobRole                  <fct> Sales Executive, Research Scientist, Laborato…\n#> $ JobSatisfaction          <fct> Very High, Medium, High, High, Medium, Very H…\n#> $ MaritalStatus            <fct> Single, Married, Single, Married, Married, Si…\n#> $ MonthlyIncome            <dbl> 5993, 5130, 2090, 2909, 3468, 3068, 2670, 269…\n#> $ MonthlyRate              <dbl> 19479, 24907, 2396, 23159, 16632, 11864, 9964…\n#> $ NumCompaniesWorked       <dbl> 8, 1, 6, 1, 9, 0, 4, 1, 0, 6, 0, 0, 1, 0, 5, …\n#> $ Over18                   <fct> Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, …\n#> $ OverTime                 <fct> Yes, No, Yes, Yes, No, No, Yes, No, No, No, N…\n#> $ PercentSalaryHike        <dbl> 11, 23, 15, 11, 12, 13, 20, 22, 21, 13, 13, 1…\n#> $ PerformanceRating        <fct> Excellent, Outstanding, Excellent, Excellent,…\n#> $ RelationshipSatisfaction <fct> Low, Very High, Medium, High, Very High, High…\n#> $ StandardHours            <dbl> 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 8…\n#> $ StockOptionLevel         <dbl> 0, 1, 0, 0, 1, 0, 3, 1, 0, 2, 1, 0, 1, 1, 0, …\n#> $ TotalWorkingYears        <dbl> 8, 10, 7, 8, 6, 8, 12, 1, 10, 17, 6, 10, 5, 3…\n#> $ TrainingTimesLastYear    <dbl> 0, 3, 3, 3, 3, 2, 3, 2, 2, 3, 5, 3, 1, 2, 4, …\n#> $ WorkLifeBalance          <fct> Bad, Better, Better, Better, Better, Good, Go…\n#> $ YearsAtCompany           <dbl> 6, 10, 0, 8, 2, 7, 1, 1, 9, 7, 5, 9, 5, 2, 4,…\n#> $ YearsInCurrentRole       <dbl> 4, 7, 0, 7, 2, 7, 0, 0, 7, 7, 4, 5, 2, 2, 2, …\n#> $ YearsSinceLastPromotion  <dbl> 0, 1, 0, 3, 2, 3, 0, 0, 1, 7, 0, 0, 4, 1, 0, …\n#> $ YearsWithCurrManager     <dbl> 5, 7, 0, 0, 2, 6, 0, 0, 8, 7, 3, 8, 3, 2, 3, …\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-10_aca31ee6df0c7c29d04ea89acd20b740'}\n\n```{.r .cell-code}\ndata_merged_tbl %>%\n        mutate_if(is.character, as.factor) %>%\n        select_if(is.factor) %>%\n        glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 1,470\n#> Columns: 16\n#> $ Attrition                <fct> Yes, No, Yes, No, No, No, No, No, No, No, No,…\n#> $ BusinessTravel           <fct> Travel_Rarely, Travel_Frequently, Travel_Rare…\n#> $ Department               <fct> Sales, Research & Development, Research & Dev…\n#> $ Education                <fct> College, Below College, College, Master, Belo…\n#> $ EducationField           <fct> Life Sciences, Life Sciences, Other, Life Sci…\n#> $ EnvironmentSatisfaction  <fct> Medium, High, Very High, Very High, Low, Very…\n#> $ Gender                   <fct> Female, Male, Male, Female, Male, Male, Femal…\n#> $ JobInvolvement           <fct> High, Medium, Medium, High, High, High, Very …\n#> $ JobRole                  <fct> Sales Executive, Research Scientist, Laborato…\n#> $ JobSatisfaction          <fct> Very High, Medium, High, High, Medium, Very H…\n#> $ MaritalStatus            <fct> Single, Married, Single, Married, Married, Si…\n#> $ Over18                   <fct> Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, …\n#> $ OverTime                 <fct> Yes, No, Yes, Yes, No, No, Yes, No, No, No, N…\n#> $ PerformanceRating        <fct> Excellent, Outstanding, Excellent, Excellent,…\n#> $ RelationshipSatisfaction <fct> Low, Very High, Medium, High, Very High, High…\n#> $ WorkLifeBalance          <fct> Bad, Better, Better, Better, Better, Good, Go…\n```\n:::\n\n```{.r .cell-code}\ndata_merged_tbl %>%\n        mutate_if(is.character, as.factor) %>%\n        select_if(is.factor) %>%\n        map(levels)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $Attrition\n#> [1] \"No\"  \"Yes\"\n#> \n#> $BusinessTravel\n#> [1] \"Non-Travel\"        \"Travel_Frequently\" \"Travel_Rarely\"    \n#> \n#> $Department\n#> [1] \"Human Resources\"        \"Research & Development\" \"Sales\"                 \n#> \n#> $Education\n#> [1] \"Below College\" \"College\"       \"Bachelor\"      \"Master\"       \n#> [5] \"Doctor\"       \n#> \n#> $EducationField\n#> [1] \"Human Resources\"  \"Life Sciences\"    \"Marketing\"        \"Medical\"         \n#> [5] \"Other\"            \"Technical Degree\"\n#> \n#> $EnvironmentSatisfaction\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $Gender\n#> [1] \"Female\" \"Male\"  \n#> \n#> $JobInvolvement\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $JobRole\n#> [1] \"Healthcare Representative\" \"Human Resources\"          \n#> [3] \"Laboratory Technician\"     \"Manager\"                  \n#> [5] \"Manufacturing Director\"    \"Research Director\"        \n#> [7] \"Research Scientist\"        \"Sales Executive\"          \n#> [9] \"Sales Representative\"     \n#> \n#> $JobSatisfaction\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $MaritalStatus\n#> [1] \"Divorced\" \"Married\"  \"Single\"  \n#> \n#> $Over18\n#> [1] \"Y\"\n#> \n#> $OverTime\n#> [1] \"No\"  \"Yes\"\n#> \n#> $PerformanceRating\n#> [1] \"Low\"         \"Good\"        \"Excellent\"   \"Outstanding\"\n#> \n#> $RelationshipSatisfaction\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $WorkLifeBalance\n#> [1] \"Bad\"    \"Good\"   \"Better\" \"Best\"\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-11_d4231acb2affefc8523012fab50a979f'}\n\n```{.r .cell-code}\ndata_processed_tbl <- data_merged_tbl %>%        \n        mutate_if(is.character, as.factor) %>%\n        mutate(\n            BusinessTravel = BusinessTravel %>% fct_relevel(\"Non-Travel\", \n                                                            \"Travel_Rarely\", \n                                                            \"Travel_Frequently\"),\n            MaritalStatus  = MaritalStatus %>% fct_relevel(\"Single\", \n                                                           \"Married\", \n                                                           \"Divorced\")\n        )\n        \ndata_processed_tbl %>% \n  select_if(is.factor) %>% \n  map(levels)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $Attrition\n#> [1] \"No\"  \"Yes\"\n#> \n#> $BusinessTravel\n#> [1] \"Non-Travel\"        \"Travel_Rarely\"     \"Travel_Frequently\"\n#> \n#> $Department\n#> [1] \"Human Resources\"        \"Research & Development\" \"Sales\"                 \n#> \n#> $Education\n#> [1] \"Below College\" \"College\"       \"Bachelor\"      \"Master\"       \n#> [5] \"Doctor\"       \n#> \n#> $EducationField\n#> [1] \"Human Resources\"  \"Life Sciences\"    \"Marketing\"        \"Medical\"         \n#> [5] \"Other\"            \"Technical Degree\"\n#> \n#> $EnvironmentSatisfaction\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $Gender\n#> [1] \"Female\" \"Male\"  \n#> \n#> $JobInvolvement\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $JobRole\n#> [1] \"Healthcare Representative\" \"Human Resources\"          \n#> [3] \"Laboratory Technician\"     \"Manager\"                  \n#> [5] \"Manufacturing Director\"    \"Research Director\"        \n#> [7] \"Research Scientist\"        \"Sales Executive\"          \n#> [9] \"Sales Representative\"     \n#> \n#> $JobSatisfaction\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $MaritalStatus\n#> [1] \"Single\"   \"Married\"  \"Divorced\"\n#> \n#> $Over18\n#> [1] \"Y\"\n#> \n#> $OverTime\n#> [1] \"No\"  \"Yes\"\n#> \n#> $PerformanceRating\n#> [1] \"Low\"         \"Good\"        \"Excellent\"   \"Outstanding\"\n#> \n#> $RelationshipSatisfaction\n#> [1] \"Low\"       \"Medium\"    \"High\"      \"Very High\"\n#> \n#> $WorkLifeBalance\n#> [1] \"Bad\"    \"Good\"   \"Better\" \"Best\"\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-12_5f3c61f7e3666f43113bc43f007a66ea'}\n\n```{.r .cell-code}\nsource(\"process_hr_data_readable.R\")\n\nprocess_hr_data_readable(employee_attrition_tbl, definitions_raw_tbl) %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Joining with `by = join_by(Education)`\n#> Joining with `by = join_by(EnvironmentSatisfaction)`\n#> Joining with `by = join_by(JobInvolvement)`\n#> Joining with `by = join_by(JobSatisfaction)`\n#> Joining with `by = join_by(PerformanceRating)`\n#> Joining with `by = join_by(RelationshipSatisfaction)`\n#> Joining with `by = join_by(WorkLifeBalance)`\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 1,470\n#> Columns: 35\n#> $ Age                      <dbl> 41, 49, 37, 33, 27, 32, 59, 30, 38, 36, 35, 2…\n#> $ Attrition                <fct> Yes, No, Yes, No, No, No, No, No, No, No, No,…\n#> $ BusinessTravel           <fct> Travel_Rarely, Travel_Frequently, Travel_Rare…\n#> $ DailyRate                <dbl> 1102, 279, 1373, 1392, 591, 1005, 1324, 1358,…\n#> $ Department               <fct> Sales, Research & Development, Research & Dev…\n#> $ DistanceFromHome         <dbl> 1, 8, 2, 3, 2, 2, 3, 24, 23, 27, 16, 15, 26, …\n#> $ Education                <fct> College, Below College, College, Master, Belo…\n#> $ EducationField           <fct> Life Sciences, Life Sciences, Other, Life Sci…\n#> $ EmployeeCount            <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n#> $ EmployeeNumber           <dbl> 1, 2, 4, 5, 7, 8, 10, 11, 12, 13, 14, 15, 16,…\n#> $ EnvironmentSatisfaction  <fct> Medium, High, Very High, Very High, Low, Very…\n#> $ Gender                   <fct> Female, Male, Male, Female, Male, Male, Femal…\n#> $ HourlyRate               <dbl> 94, 61, 92, 56, 40, 79, 81, 67, 44, 94, 84, 4…\n#> $ JobInvolvement           <fct> High, Medium, Medium, High, High, High, Very …\n#> $ JobLevel                 <dbl> 2, 2, 1, 1, 1, 1, 1, 1, 3, 2, 1, 2, 1, 1, 1, …\n#> $ JobRole                  <fct> Sales Executive, Research Scientist, Laborato…\n#> $ JobSatisfaction          <fct> Very High, Medium, High, High, Medium, Very H…\n#> $ MaritalStatus            <fct> Single, Married, Single, Married, Married, Si…\n#> $ MonthlyIncome            <dbl> 5993, 5130, 2090, 2909, 3468, 3068, 2670, 269…\n#> $ MonthlyRate              <dbl> 19479, 24907, 2396, 23159, 16632, 11864, 9964…\n#> $ NumCompaniesWorked       <dbl> 8, 1, 6, 1, 9, 0, 4, 1, 0, 6, 0, 0, 1, 0, 5, …\n#> $ Over18                   <fct> Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, …\n#> $ OverTime                 <fct> Yes, No, Yes, Yes, No, No, Yes, No, No, No, N…\n#> $ PercentSalaryHike        <dbl> 11, 23, 15, 11, 12, 13, 20, 22, 21, 13, 13, 1…\n#> $ PerformanceRating        <fct> Excellent, Outstanding, Excellent, Excellent,…\n#> $ RelationshipSatisfaction <fct> Low, Very High, Medium, High, Very High, High…\n#> $ StandardHours            <dbl> 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 8…\n#> $ StockOptionLevel         <dbl> 0, 1, 0, 0, 1, 0, 3, 1, 0, 2, 1, 0, 1, 1, 0, …\n#> $ TotalWorkingYears        <dbl> 8, 10, 7, 8, 6, 8, 12, 1, 10, 17, 6, 10, 5, 3…\n#> $ TrainingTimesLastYear    <dbl> 0, 3, 3, 3, 3, 2, 3, 2, 2, 3, 5, 3, 1, 2, 4, …\n#> $ WorkLifeBalance          <fct> Bad, Better, Better, Better, Better, Good, Go…\n#> $ YearsAtCompany           <dbl> 6, 10, 0, 8, 2, 7, 1, 1, 9, 7, 5, 9, 5, 2, 4,…\n#> $ YearsInCurrentRole       <dbl> 4, 7, 0, 7, 2, 7, 0, 0, 7, 7, 4, 5, 2, 2, 2, …\n#> $ YearsSinceLastPromotion  <dbl> 0, 1, 0, 3, 2, 3, 0, 0, 1, 7, 0, 0, 4, 1, 0, …\n#> $ YearsWithCurrManager     <dbl> 5, 7, 0, 0, 2, 6, 0, 0, 8, 7, 3, 8, 3, 2, 3, …\n```\n:::\n:::\n\n# DATA PREPARATION ----\n# Machine readable ----\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-13_02bc0c08e07bd051041d24e88dff7396'}\n\n```{.r .cell-code}\n# Processing pipeline\n\nemployee_attrition_readable_tbl <- process_hr_data_readable(employee_attrition_tbl, definitions_raw_tbl)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Joining with `by = join_by(Education)`\n#> Joining with `by = join_by(EnvironmentSatisfaction)`\n#> Joining with `by = join_by(JobInvolvement)`\n#> Joining with `by = join_by(JobSatisfaction)`\n#> Joining with `by = join_by(PerformanceRating)`\n#> Joining with `by = join_by(RelationshipSatisfaction)`\n#> Joining with `by = join_by(WorkLifeBalance)`\n```\n:::\n\n```{.r .cell-code}\n# Split into test and train\nset.seed(seed = 1113)\nsplit_obj <- rsample::initial_split(employee_attrition_readable_tbl, prop = 0.85)\n\n# Assign training and test data\ntrain_readable_tbl <- training(split_obj)\ntest_readable_tbl  <- testing(split_obj)\n```\n:::\n\n# Plot Faceted Histgoram function\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-14_1006e40c7833def1472db261b7bbbfee'}\n\n```{.r .cell-code}\nsource(\"plot_hist_facet.R\")\n\n\n# To create a function and test it, we can assign our data temporarily to data\ndata <- train_readable_tbl \n\n# Example calls\ntrain_readable_tbl %>% plot_hist_facet()\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\ntrain_readable_tbl %>% plot_hist_facet(fct_rev = T)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-14-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Bring attirtion to the top (alt.: select(Attrition, everything()))\ntrain_readable_tbl %>% \n  relocate(Attrition) %>% \n  plot_hist_facet()\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-14-3.png){width=672}\n:::\n:::\n\n# Data Preprocessing With Recipes ----\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-15_0da97be64a670c1b74fd68a0753c069d'}\n\n```{.r .cell-code}\n# Plan: Correlation Analysis\n\n# 1. Zero Variance Features ----\n\nrecipe_obj <- recipe(Attrition ~ ., data = train_readable_tbl) %>%\n    step_zv(all_predictors())\n\nrecipe_obj %>% \n      prep()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Recipe ──────────────────────────────────────────────────────────────────────\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Inputs\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Number of variables by role\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> outcome:    1\n#> predictor: 34\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Training information\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Training data contained 1249 data points and no incomplete rows.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Operations\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> • Zero variance filter removed: EmployeeCount, Over18, StandardHours | Trained\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-16_9fc04eefefd6bce1b5b6a6c221383621'}\n\n```{.r .cell-code}\n# 2. Transformations ---- (for skewed features)\n\n\nskewed_feature_names <- train_readable_tbl %>%\n    select(where(is.numeric)) %>%\n    map_df(skewness) %>%\n    pivot_longer(cols = everything(),\n                 names_to = \"key\",\n                 values_to = \"value\",\n                 names_transform = list(key = forcats::fct_inorder)) %>%\n    arrange(desc(value)) %>%\n    \n    # Let's set the cutoff value to 0.7 (beccause TrainingTimesLastYear does not seem to be that skewed)\n    filter(value >= 0.7) %>%\n    pull(key) %>%\n    as.character()\n\ntrain_readable_tbl %>%\n    select(all_of(skewed_feature_names)) %>%\n    plot_hist_facet()\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-17_0edca072f9e1cd77c504fc5feffe5cc1'}\n\n```{.r .cell-code}\n!skewed_feature_names %in% c(\"JobLevel\", \"StockOptionLevel\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE\n```\n:::\n\n```{.r .cell-code}\nskewed_feature_names <- train_readable_tbl %>%\n    select(where(is.numeric)) %>%\n    map_df(skewness) %>%\n    pivot_longer(cols = everything(),\n                 names_to = \"key\",\n                 values_to = \"value\",\n                 names_transform = list(key = forcats::fct_inorder)) %>%\n    arrange(desc(value)) %>%\n    filter(value >= 0.7) %>%\n    filter(!key %in% c(\"JobLevel\", \"StockOptionLevel\")) %>%\n    pull(key) %>%\n    as.character()\n    \n# We need to convert those columns to factors in the next step\nfactor_names <- c(\"JobLevel\", \"StockOptionLevel\")\n```\n:::\n\n# Fix Skewness with step_yeoJohnson()\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-18_744a637f903275ad28ecfcf8ddbb2e0b'}\n\n```{.r .cell-code}\nrecipe_obj <- recipe(Attrition ~ ., data = train_readable_tbl) %>%\n    step_zv(all_predictors()) %>%\n    step_YeoJohnson(skewed_feature_names) %>%\n    step_mutate_at(factor_names, fn = as.factor)\n    \nrecipe_obj %>% \n    prep() %>% \n    bake(train_readable_tbl) %>% \n    select(skewed_feature_names) %>%\n    plot_hist_facet()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.\n#> ℹ Please use `all_of()` or `any_of()` instead.\n#>   # Was:\n#>   data %>% select(skewed_feature_names)\n#> \n#>   # Now:\n#>   data %>% select(all_of(skewed_feature_names))\n#> \n#> See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.\n#> ℹ Please use `all_of()` or `any_of()` instead.\n#>   # Was:\n#>   data %>% select(factor_names)\n#> \n#>   # Now:\n#>   data %>% select(all_of(factor_names))\n#> \n#> See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.\n```\n:::\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n# 3. Center and scale\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-19_fe111bc8882625519eb5b3e297cf38e0'}\n\n```{.r .cell-code}\n# Plot numeric data\ntrain_readable_tbl %>% \n  select(where(is.numeric)) %>% \n  plot_hist_facet()\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-20_233367a2e85a34236fa904a41509cd2b'}\n\n```{.r .cell-code}\nrecipe_obj <- recipe(Attrition ~ ., data = train_readable_tbl) %>%\n    step_zv(all_predictors()) %>%\n    step_YeoJohnson(skewed_feature_names) %>%\n    step_mutate_at(factor_names, fn = as.factor) %>%\n    step_center(all_numeric()) %>%\n    step_scale(all_numeric())\n\n# You can compare the means attribute before and after prepping the recipe\nrecipe_obj$steps[[4]] # before prep\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $terms\n#> <list_of<quosure>>\n#> \n#> [[1]]\n#> <quosure>\n#> expr: ^all_numeric()\n#> env:  0x000001d553d3c140\n#> \n#> \n#> $role\n#> [1] NA\n#> \n#> $trained\n#> [1] FALSE\n#> \n#> $means\n#> NULL\n#> \n#> $na_rm\n#> [1] TRUE\n#> \n#> $skip\n#> [1] FALSE\n#> \n#> $id\n#> [1] \"center_GWd48\"\n#> \n#> $case_weights\n#> NULL\n#> \n#> attr(,\"class\")\n#> [1] \"step_center\" \"step\"\n```\n:::\n\n```{.r .cell-code}\nprepared_recipe <- recipe_obj %>% prep()\nprepared_recipe$steps[[4]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $terms\n#> <list_of<quosure>>\n#> \n#> [[1]]\n#> <quosure>\n#> expr: ^all_numeric()\n#> env:  0x000001d553d3c140\n#> \n#> \n#> $role\n#> [1] NA\n#> \n#> $trained\n#> [1] TRUE\n#> \n#> $means\n#>                     Age               DailyRate        DistanceFromHome \n#>            3.689672e+01            7.978519e+02            2.009472e+00 \n#>          EmployeeNumber              HourlyRate           MonthlyIncome \n#>            1.039169e+03            6.595757e+01            3.926886e+00 \n#>             MonthlyRate      NumCompaniesWorked       PercentSalaryHike \n#>            1.447811e+04            1.050292e+00            6.783763e-01 \n#>       TotalWorkingYears   TrainingTimesLastYear          YearsAtCompany \n#>            3.352732e+00            2.786229e+00            2.011652e+00 \n#>      YearsInCurrentRole YearsSinceLastPromotion    YearsWithCurrManager \n#>            1.727181e+00            5.225350e-01            1.709616e+00 \n#> \n#> $na_rm\n#> [1] TRUE\n#> \n#> $skip\n#> [1] FALSE\n#> \n#> $id\n#> [1] \"center_GWd48\"\n#> \n#> $case_weights\n#> NULL\n#> \n#> attr(,\"class\")\n#> [1] \"step_center\" \"step\"\n```\n:::\n\n```{.r .cell-code}\nprepared_recipe %>%\n    bake(new_data = train_readable_tbl) %>%\n    select(where(is.numeric)) %>% \n    plot_hist_facet()\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-21_31060d53b0c5fd449e3d7c6f3df15d33'}\n\n```{.r .cell-code}\n# 4. Dummy variables ----\n\nrecipe_obj <- recipe(Attrition ~ ., data = train_readable_tbl) %>%\n    step_zv(all_predictors()) %>%\n    step_YeoJohnson(skewed_feature_names) %>%\n    step_mutate_at(factor_names, fn = as.factor) %>%\n    step_center(all_numeric()) %>%\n    step_scale(all_numeric()) %>%\n    step_dummy(all_nominal()) %>% \n    \n    # prepare the final recipe\n    prep()\n```\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-22_661a18a30b525b8bcebc4af903f9cc72'}\n\n```{.r .cell-code}\ntrain_tbl <- bake(recipe_obj, new_data = train_readable_tbl)\n\ntrain_tbl %>% glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 1,249\n#> Columns: 66\n#> $ Age                                <dbl> 0.12135569, 1.66128715, 0.56133611,…\n#> $ DailyRate                          <dbl> 1.72799052, 1.72799052, 1.16626413,…\n#> $ DistanceFromHome                   <dbl> -1.0115152, -0.4249586, -0.6817922,…\n#> $ EmployeeNumber                     <dbl> -0.80492713, -0.82158646, -0.241841…\n#> $ HourlyRate                         <dbl> -1.19426800, -1.79245965, 1.4477451…\n#> $ MonthlyIncome                      <dbl> -1.86207613, 1.63117757, 0.07274848…\n#> $ MonthlyRate                        <dbl> -0.3347480, -0.5881964, 1.3050466, …\n#> $ NumCompaniesWorked                 <dbl> -0.57820949, 0.02672436, 0.02672436…\n#> $ PercentSalaryHike                  <dbl> 1.6610314, -0.4802126, -0.4802126, …\n#> $ TotalWorkingYears                  <dbl> -2.00413096, 1.96812006, 0.86999363…\n#> $ TrainingTimesLastYear              <dbl> 0.1653511, -0.6081451, -1.3816412, …\n#> $ YearsAtCompany                     <dbl> -1.45454900, -0.05799426, -0.057994…\n#> $ YearsInCurrentRole                 <dbl> -1.60865321, -0.43886958, -0.078447…\n#> $ YearsSinceLastPromotion            <dbl> -1.0965229, 0.1067096, 0.1067096, -…\n#> $ YearsWithCurrManager               <dbl> -1.56287774, 0.23200520, -0.0599865…\n#> $ BusinessTravel_Travel_Rarely       <dbl> 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1,…\n#> $ BusinessTravel_Travel_Frequently   <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…\n#> $ Department_Research...Development  <dbl> 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1,…\n#> $ Department_Sales                   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0,…\n#> $ Education_College                  <dbl> 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ Education_Bachelor                 <dbl> 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0,…\n#> $ Education_Master                   <dbl> 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1,…\n#> $ Education_Doctor                   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ EducationField_Life.Sciences       <dbl> 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0,…\n#> $ EducationField_Marketing           <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…\n#> $ EducationField_Medical             <dbl> 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0,…\n#> $ EducationField_Other               <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ EducationField_Technical.Degree    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,…\n#> $ EnvironmentSatisfaction_Medium     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,…\n#> $ EnvironmentSatisfaction_High       <dbl> 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0,…\n#> $ EnvironmentSatisfaction_Very.High  <dbl> 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0,…\n#> $ Gender_Male                        <dbl> 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1,…\n#> $ JobInvolvement_Medium              <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobInvolvement_High                <dbl> 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1,…\n#> $ JobInvolvement_Very.High           <dbl> 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0,…\n#> $ JobLevel_X2                        <dbl> 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0,…\n#> $ JobLevel_X3                        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobLevel_X4                        <dbl> 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,…\n#> $ JobLevel_X5                        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobRole_Human.Resources            <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobRole_Laboratory.Technician      <dbl> 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0,…\n#> $ JobRole_Manager                    <dbl> 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,…\n#> $ JobRole_Manufacturing.Director     <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobRole_Research.Director          <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobRole_Research.Scientist         <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,…\n#> $ JobRole_Sales.Executive            <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…\n#> $ JobRole_Sales.Representative       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ JobSatisfaction_Medium             <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1,…\n#> $ JobSatisfaction_High               <dbl> 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0,…\n#> $ JobSatisfaction_Very.High          <dbl> 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0,…\n#> $ MaritalStatus_Married              <dbl> 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1,…\n#> $ MaritalStatus_Divorced             <dbl> 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0,…\n#> $ OverTime_Yes                       <dbl> 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0,…\n#> $ PerformanceRating_Good             <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ PerformanceRating_Excellent        <dbl> 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1,…\n#> $ PerformanceRating_Outstanding      <dbl> 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…\n#> $ RelationshipSatisfaction_Medium    <dbl> 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0,…\n#> $ RelationshipSatisfaction_High      <dbl> 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1,…\n#> $ RelationshipSatisfaction_Very.High <dbl> 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ StockOptionLevel_X1                <dbl> 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1,…\n#> $ StockOptionLevel_X2                <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0,…\n#> $ StockOptionLevel_X3                <dbl> 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0,…\n#> $ WorkLifeBalance_Good               <dbl> 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1,…\n#> $ WorkLifeBalance_Better             <dbl> 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0,…\n#> $ WorkLifeBalance_Best               <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n#> $ Attrition_Yes                      <dbl> 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0,…\n```\n:::\n\n```{.r .cell-code}\ntest_tbl <- bake(recipe_obj, new_data = test_readable_tbl)\n```\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-23_7eab47d0f485a0c37f42b6b64aa3d1cd'}\n\n```{.r .cell-code}\ntrain_tbl %>%\n\n        # Convert characters & factors to numeric\n        mutate(across(where(is.character), as.factor)) %>%\n        mutate(across(where(is.factor), as.numeric)) %>%\n        \n        # Correlation\n        cor(use = \"pairwise.complete.obs\") %>% \n        as_tibble() %>%\n        mutate(feature = names(.)) %>% \n        select(feature, Attrition_Yes) %>% \n        \n        # Filter the target, because we now the correlation is 100%\n        filter(!(feature == \"Attrition_Yes\")) %>% \n        \n        # Convert character back to factors\n        mutate(across(where(is.character), as_factor))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in stats::cor(x, ...): Standardabweichung ist Null\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"feature\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Attrition_Yes\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Age\",\"2\":\"-0.161863233\"},{\"1\":\"DailyRate\",\"2\":\"-0.062467471\"},{\"1\":\"DistanceFromHome\",\"2\":\"0.079603606\"},{\"1\":\"EmployeeNumber\",\"2\":\"-0.019686125\"},{\"1\":\"HourlyRate\",\"2\":\"-0.015333593\"},{\"1\":\"MonthlyIncome\",\"2\":\"-0.202617100\"},{\"1\":\"MonthlyRate\",\"2\":\"0.013928255\"},{\"1\":\"NumCompaniesWorked\",\"2\":\"0.033238730\"},{\"1\":\"PercentSalaryHike\",\"2\":\"0.002315050\"},{\"1\":\"TotalWorkingYears\",\"2\":\"-0.224528615\"},{\"1\":\"TrainingTimesLastYear\",\"2\":\"-0.066405747\"},{\"1\":\"YearsAtCompany\",\"2\":\"-0.202041403\"},{\"1\":\"YearsInCurrentRole\",\"2\":\"-0.182338959\"},{\"1\":\"YearsSinceLastPromotion\",\"2\":\"-0.057213055\"},{\"1\":\"YearsWithCurrManager\",\"2\":\"-0.185668369\"},{\"1\":\"BusinessTravel_Travel_Rarely\",\"2\":\"-0.066999036\"},{\"1\":\"BusinessTravel_Travel_Frequently\",\"2\":\"0.131670210\"},{\"1\":\"Department_Research...Development\",\"2\":\"-0.077267266\"},{\"1\":\"Department_Sales\",\"2\":\"0.071976341\"},{\"1\":\"Education_College\",\"2\":\"-0.008304072\"},{\"1\":\"Education_Bachelor\",\"2\":\"0.039484357\"},{\"1\":\"Education_Master\",\"2\":\"-0.039711617\"},{\"1\":\"Education_Doctor\",\"2\":\"-0.019979377\"},{\"1\":\"EducationField_Life.Sciences\",\"2\":\"-0.043389660\"},{\"1\":\"EducationField_Marketing\",\"2\":\"0.071002498\"},{\"1\":\"EducationField_Medical\",\"2\":\"-0.062707595\"},{\"1\":\"EducationField_Other\",\"2\":\"0.004807121\"},{\"1\":\"EducationField_Technical.Degree\",\"2\":\"0.067398461\"},{\"1\":\"EnvironmentSatisfaction_Medium\",\"2\":\"-0.010366082\"},{\"1\":\"EnvironmentSatisfaction_High\",\"2\":\"-0.039834673\"},{\"1\":\"EnvironmentSatisfaction_Very.High\",\"2\":\"-0.062012224\"},{\"1\":\"Gender_Male\",\"2\":\"0.029607646\"},{\"1\":\"JobInvolvement_Medium\",\"2\":\"0.041743621\"},{\"1\":\"JobInvolvement_High\",\"2\":\"-0.048309106\"},{\"1\":\"JobInvolvement_Very.High\",\"2\":\"-0.056695527\"},{\"1\":\"JobLevel_X2\",\"2\":\"-0.117148966\"},{\"1\":\"JobLevel_X3\",\"2\":\"-0.033059969\"},{\"1\":\"JobLevel_X4\",\"2\":\"-0.088374729\"},{\"1\":\"JobLevel_X5\",\"2\":\"-0.049808190\"},{\"1\":\"JobRole_Human.Resources\",\"2\":\"0.034011470\"},{\"1\":\"JobRole_Laboratory.Technician\",\"2\":\"0.091462301\"},{\"1\":\"JobRole_Manager\",\"2\":\"-0.072513108\"},{\"1\":\"JobRole_Manufacturing.Director\",\"2\":\"-0.075265877\"},{\"1\":\"JobRole_Research.Director\",\"2\":\"-0.097903674\"},{\"1\":\"JobRole_Research.Scientist\",\"2\":\"0.005663501\"},{\"1\":\"JobRole_Sales.Executive\",\"2\":\"0.015358456\"},{\"1\":\"JobRole_Sales.Representative\",\"2\":\"0.141362385\"},{\"1\":\"JobSatisfaction_Medium\",\"2\":\"0.003765563\"},{\"1\":\"JobSatisfaction_High\",\"2\":\"0.027719307\"},{\"1\":\"JobSatisfaction_Very.High\",\"2\":\"-0.096861825\"},{\"1\":\"MaritalStatus_Married\",\"2\":\"-0.085519597\"},{\"1\":\"MaritalStatus_Divorced\",\"2\":\"-0.064737234\"},{\"1\":\"OverTime_Yes\",\"2\":\"0.257056780\"},{\"1\":\"PerformanceRating_Good\",\"2\":\"NA\"},{\"1\":\"PerformanceRating_Excellent\",\"2\":\"-0.020646607\"},{\"1\":\"PerformanceRating_Outstanding\",\"2\":\"0.020646607\"},{\"1\":\"RelationshipSatisfaction_Medium\",\"2\":\"0.001499324\"},{\"1\":\"RelationshipSatisfaction_High\",\"2\":\"-0.039834673\"},{\"1\":\"RelationshipSatisfaction_Very.High\",\"2\":\"-0.022170769\"},{\"1\":\"StockOptionLevel_X1\",\"2\":\"-0.136870926\"},{\"1\":\"StockOptionLevel_X2\",\"2\":\"-0.077868538\"},{\"1\":\"StockOptionLevel_X3\",\"2\":\"0.028975031\"},{\"1\":\"WorkLifeBalance_Good\",\"2\":\"0.008375398\"},{\"1\":\"WorkLifeBalance_Better\",\"2\":\"-0.061330453\"},{\"1\":\"WorkLifeBalance_Best\",\"2\":\"0.021122532\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-24_f9c93f5068826bb25de85545b38b82c0'}\n\n```{.r .cell-code}\nsource(\"get_cor.R\")\n\nsource(\"plot_cor.R\")\n\nplot_cor(data = train_tbl, target = Attrition_Yes, fct_reorder = T, fct_rev = T)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: `as.tibble()` was deprecated in tibble 2.0.0.\n#> ℹ Please use `as_tibble()` instead.\n#> ℹ The signature and semantics have changed, see `?as_tibble`.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in stats::cor(x, ...): Standardabweichung ist Null\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: There was 1 warning in `mutate()`.\n#> ℹ In argument: `feature = fct_reorder(feature, Attrition_Yes)`.\n#> Caused by warning:\n#> ! `fct_reorder()` removing 1 missing value.\n#> ℹ Use `.na_rm = TRUE` to silence this message.\n#> ℹ Use `.na_rm = FALSE` to preserve NAs.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n#> ℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Removed 1 rows containing missing values (`geom_segment()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Removed 1 rows containing missing values (`geom_label()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-25_ccf919419678f953d730c200cd52b450'}\n\n```{.r .cell-code}\ntrain_tbl %>% \n  select(Attrition_Yes, contains(\"JobRole\")) %>% \n  plot_cor(target = Attrition_Yes, fct_reorder = T, fct_rev = T)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n# Correlation Evaluation ----\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-26_561f6976dfbcfcca207748b35c79de38'}\n\n```{.r .cell-code}\n#   1. Descriptive features: age, gender, marital status \ntrain_tbl %>%\n    select(Attrition_Yes, Age, contains(\"Gender\"), \n           contains(\"MaritalStatus\"), NumCompaniesWorked, \n           contains(\"Over18\"), DistanceFromHome) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = T, fct_rev = F)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-27_385e6c176386aec4b3bae7d792f39743'}\n\n```{.r .cell-code}\n#   2. Employment features: department, job role, job level\ntrain_tbl %>%\n     select(Attrition_Yes, contains(\"employee\"), contains(\"department\"), contains(\"job\")) %>%\n     plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F) \n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#   3. Compensation features: HourlyRate, MonthlyIncome, StockOptionLevel \ntrain_tbl %>%\n    select(Attrition_Yes, contains(\"income\"), contains(\"rate\"), contains(\"salary\"), contains(\"stock\")) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#   4. Survey Results: Satisfaction level, WorkLifeBalance \ntrain_tbl %>%\n    select(Attrition_Yes, contains(\"satisfaction\"), contains(\"life\")) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#   5. Performance Data: Job Involvment, Performance Rating\ntrain_tbl %>%\n    select(Attrition_Yes, contains(\"performance\"), contains(\"involvement\")) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in stats::cor(x, ...): Standardabweichung ist Null\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Removed 1 rows containing missing values (`geom_segment()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Removed 1 rows containing missing values (`geom_label()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#   6. Work-Life Features \ntrain_tbl %>%\n    select(Attrition_Yes, contains(\"overtime\"), contains(\"travel\")) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-5.png){width=672}\n:::\n\n```{.r .cell-code}\n#   7. Training and Education \ntrain_tbl %>%\n    select(Attrition_Yes, contains(\"training\"), contains(\"education\")) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-6.png){width=672}\n:::\n\n```{.r .cell-code}\n#   8. Time-Based Features: Years at company, years in current role\ntrain_tbl %>%\n    select(Attrition_Yes, contains(\"years\")) %>%\n    plot_cor(target = Attrition_Yes, fct_reorder = F, fct_rev = F)\n```\n\n::: {.cell-output-display}\n![](Challenge4_files/figure-html/unnamed-chunk-27-7.png){width=672}\n:::\n:::\n\n# H2o\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-28_dbe6cb71e77cfc76bd4f00e0289dc927'}\n\n```{.r .cell-code}\nemployee_attrition_tbl          <- read_csv(\"datasets-1067-1925-WA_Fn-UseC_-HR-Employee-Attrition.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Rows: 1470 Columns: 35\n#> ── Column specification ────────────────────────────────────────────────────────\n#> Delimiter: \",\"\n#> chr  (9): Attrition, BusinessTravel, Department, EducationField, Gender, Job...\n#> dbl (26): Age, DailyRate, DistanceFromHome, Education, EmployeeCount, Employ...\n#> \n#> ℹ Use `spec()` to retrieve the full column specification for this data.\n#> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\ndefinitions_raw_tbl             <- read_excel(\"data_definitions.xlsx\", sheet = 1, col_names = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> New names:\n#> • `` -> `...1`\n#> • `` -> `...2`\n```\n:::\n\n```{.r .cell-code}\nemployee_attrition_readable_tbl <- process_hr_data_readable(employee_attrition_tbl, definitions_raw_tbl)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Joining with `by = join_by(Education)`\n#> Joining with `by = join_by(EnvironmentSatisfaction)`\n#> Joining with `by = join_by(JobInvolvement)`\n#> Joining with `by = join_by(JobSatisfaction)`\n#> Joining with `by = join_by(PerformanceRating)`\n#> Joining with `by = join_by(RelationshipSatisfaction)`\n#> Joining with `by = join_by(WorkLifeBalance)`\n```\n:::\n\n```{.r .cell-code}\nset.seed(seed = 1113)\nsplit_obj                       <- rsample::initial_split(employee_attrition_readable_tbl, prop = 0.85)\ntrain_readable_tbl              <- training(split_obj)\ntest_readable_tbl               <- testing(split_obj)\n\nrecipe_obj <- recipe(Attrition ~., data = train_readable_tbl) %>% \n    step_zv(all_predictors()) %>% \n    step_mutate_at(JobLevel, StockOptionLevel, fn = as.factor) %>% \n    prep()\n\ntrain_tbl <- bake(recipe_obj, new_data = train_readable_tbl)\ntest_tbl  <- bake(recipe_obj, new_data = test_readable_tbl)\n```\n:::\n\n# Modeling\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-29_0f35ab218a65af10476c53e1fec09068'}\n\n```{.r .cell-code}\nh2o.init()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  Connection successful!\n#> \n#> R is connected to the H2O cluster: \n#>     H2O cluster uptime:         7 minutes 10 seconds \n#>     H2O cluster timezone:       Europe/Berlin \n#>     H2O data parsing timezone:  UTC \n#>     H2O cluster version:        3.40.0.1 \n#>     H2O cluster version age:    3 months and 21 days \n#>     H2O cluster name:           H2O_started_from_R_tiend_htd163 \n#>     H2O cluster total nodes:    1 \n#>     H2O cluster total memory:   3.97 GB \n#>     H2O cluster total cores:    12 \n#>     H2O cluster allowed cores:  12 \n#>     H2O cluster healthy:        TRUE \n#>     H2O Connection ip:          localhost \n#>     H2O Connection port:        54321 \n#>     H2O Connection proxy:       NA \n#>     H2O Internal Security:      FALSE \n#>     R Version:                  R version 4.2.3 (2023-03-15 ucrt)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in h2o.clusterInfo(): \n#> Your H2O cluster version is (3 months and 21 days) old. There may be a newer version available.\n#> Please download and install the latest version from: https://h2o-release.s3.amazonaws.com/h2o/latest_stable.html\n```\n:::\n\n```{.r .cell-code}\n# Split data into a training and a validation data frame\n# Setting the seed is just for reproducability\nsplit_h2o <- h2o.splitFrame(as.h2o(train_tbl), ratios = c(0.85), seed = 1234)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\ntrain_h2o <- split_h2o[[1]]\nvalid_h2o <- split_h2o[[2]]\ntest_h2o  <- as.h2o(test_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\n# Set the target and predictors\ny <- \"Attrition\"\nx <- setdiff(names(train_h2o), y)\n```\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-30_77c8ad8403badda396c0646fae88a8e2'}\n\n```{.r .cell-code}\nautoml_models_h2o <- h2o.automl(\n  x = x,\n  y = y,\n  training_frame    = train_h2o,\n  validation_frame  = valid_h2o,\n  leaderboard_frame = test_h2o,\n  max_runtime_secs  = 30,\n  nfolds            = 5 \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n#> 17:18:52.466: User specified a validation frame with cross-validation still enabled. Please note that the models will still be validated using cross-validation only, the validation frame will be used to provide purely informative validation metrics on the trained models.\n#> 17:18:52.480: AutoML: XGBoost is not available; skipping it.\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-31_4619f7daa937f5dbc31beaf26f59537e'}\n\n```{.r .cell-code}\ntypeof(automl_models_h2o)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"S4\"\n```\n:::\n\n```{.r .cell-code}\n## \"S4\"\n\nslotNames(automl_models_h2o)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"project_name\"   \"leader\"         \"leaderboard\"    \"event_log\"     \n#> [5] \"modeling_steps\" \"training_info\"\n```\n:::\n\n```{.r .cell-code}\n## [1] \"project_name\"   \"leader\"         \"leaderboard\"    \"event_log\"      \"modeling_steps\" \"training_info\" \n\nautoml_models_h2o@leaderboard\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                                                  model_id       auc   logloss\n#> 1    StackedEnsemble_AllModels_3_AutoML_1_20230530_171852 0.8619671 0.3402972\n#> 2 StackedEnsemble_BestOfFamily_3_AutoML_1_20230530_171852 0.8608115 0.3431713\n#> 3    StackedEnsemble_AllModels_2_AutoML_1_20230530_171852 0.8595275 0.3448641\n#> 4    DeepLearning_grid_1_AutoML_1_20230530_171852_model_5 0.8585003 0.3609126\n#> 5 StackedEnsemble_BestOfFamily_2_AutoML_1_20230530_171852 0.8574730 0.3481280\n#> 6    StackedEnsemble_AllModels_1_AutoML_1_20230530_171852 0.8546482 0.3510403\n#>       aucpr mean_per_class_error      rmse       mse\n#> 1 0.7127354            0.2242553 0.3206319 0.1028048\n#> 2 0.7108188            0.2157165 0.3208255 0.1029290\n#> 3 0.7086241            0.2270801 0.3222869 0.1038689\n#> 4 0.7034980            0.2469183 0.3335267 0.1112401\n#> 5 0.7087796            0.2242553 0.3220012 0.1036848\n#> 6 0.7052256            0.2299050 0.3245814 0.1053531\n#> \n#> [44 rows x 7 columns]\n```\n:::\n\n```{.r .cell-code}\n##                                              model_id       auc   logloss     aucpr mean_per_class_error      rmse        mse\n## 1 StackedEnsemble_BestOfFamily_AutoML_20200820_190823 0.8585439 0.2992854 0.5869929            0.2406915 0.2978416 0.08870964\n## 2          GBM_grid__1_AutoML_20200820_190823_model_3 0.8494016 0.3137896 0.5165541            0.2386968 0.3098134 0.09598435\n## 3 DeepLearning_grid__1_AutoML_20200820_190823_model_1 0.8479056 0.3066365 0.6154288            0.2583112 0.3071528 0.09434283\n## 4      XGBoost_grid__1_AutoML_20200820_190823_model_5 0.8439162 0.3057109 0.5299331            0.2061170 0.3071419 0.09433613\n## 5    StackedEnsemble_AllModels_AutoML_20200820_190823 0.8425864 0.3211612 0.5205591            0.2539894 0.3107399 0.09655928\n## 6      XGBoost_grid__1_AutoML_20200820_190823_model_6 0.8257979 0.3211936 0.5009608            0.2536569 0.3111129 0.09679122\n##\n## [30 rows x 7 columns] \n\nautoml_models_h2o@leader\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Model Details:\n#> ==============\n#> \n#> H2OBinomialModel: stackedensemble\n#> Model ID:  StackedEnsemble_AllModels_3_AutoML_1_20230530_171852 \n#> Model Summary for Stacked Ensemble: \n#>                                          key            value\n#> 1                          Stacking strategy cross_validation\n#> 2       Number of base models (used / total)             5/32\n#> 3           # GBM base models (used / total)             3/23\n#> 4  # DeepLearning base models (used / total)              1/6\n#> 5           # GLM base models (used / total)              1/1\n#> 6           # DRF base models (used / total)              0/2\n#> 7                      Metalearner algorithm              GLM\n#> 8         Metalearner fold assignment scheme           Random\n#> 9                         Metalearner nfolds                5\n#> 10                   Metalearner fold_column               NA\n#> 11        Custom metalearner hyperparameters             None\n#> \n#> \n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on training data. **\n#> \n#> MSE:  0.05440691\n#> RMSE:  0.2332529\n#> LogLoss:  0.2078378\n#> Mean Per-Class Error:  0.1394088\n#> AUC:  0.9448809\n#> AUCPR:  0.8727572\n#> Gini:  0.8897619\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error      Rate\n#> No     896  13 0.014301   =13/909\n#> Yes     41 114 0.264516   =41/155\n#> Totals 937 127 0.050752  =54/1064\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.429638   0.808511 104\n#> 2                       max f2  0.275826   0.814677 145\n#> 3                 max f0point5  0.511391   0.871143  84\n#> 4                 max accuracy  0.433659   0.949248 102\n#> 5                max precision  0.962989   1.000000   0\n#> 6                   max recall  0.015666   1.000000 378\n#> 7              max specificity  0.962989   1.000000   0\n#> 8             max absolute_mcc  0.429638   0.784732 104\n#> 9   max min_per_class_accuracy  0.205016   0.877888 182\n#> 10 max mean_per_class_accuracy  0.275826   0.893428 145\n#> 11                     max tns  0.962989 909.000000   0\n#> 12                     max fns  0.962989 154.000000   0\n#> 13                     max fps  0.000834 909.000000 399\n#> 14                     max tps  0.015666 155.000000 378\n#> 15                     max tnr  0.962989   1.000000   0\n#> 16                     max fnr  0.962989   0.993548   0\n#> 17                     max fpr  0.000834   1.000000 399\n#> 18                     max tpr  0.015666   1.000000 378\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on validation data. **\n#> \n#> MSE:  0.1037106\n#> RMSE:  0.3220413\n#> LogLoss:  0.3405448\n#> Mean Per-Class Error:  0.1987111\n#> AUC:  0.8616183\n#> AUCPR:  0.6986968\n#> Gini:  0.7232367\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error     Rate\n#> No     135  12 0.081633  =12/147\n#> Yes     12  26 0.315789   =12/38\n#> Totals 147  38 0.129730  =24/185\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.345795   0.684211  37\n#> 2                       max f2  0.215201   0.707547  59\n#> 3                 max f0point5  0.409372   0.692771  31\n#> 4                 max accuracy  0.409372   0.870270  31\n#> 5                max precision  0.909114   1.000000   0\n#> 6                   max recall  0.025360   1.000000 149\n#> 7              max specificity  0.909114   1.000000   0\n#> 8             max absolute_mcc  0.345795   0.602578  37\n#> 9   max min_per_class_accuracy  0.215201   0.789474  59\n#> 10 max mean_per_class_accuracy  0.300718   0.804243  41\n#> 11                     max tns  0.909114 147.000000   0\n#> 12                     max fns  0.909114  37.000000   0\n#> 13                     max fps  0.002756 147.000000 184\n#> 14                     max tps  0.025360  38.000000 149\n#> 15                     max tnr  0.909114   1.000000   0\n#> 16                     max fnr  0.909114   0.973684   0\n#> 17                     max fpr  0.002756   1.000000 184\n#> 18                     max tpr  0.025360   1.000000 149\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on cross-validation data. **\n#> ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **\n#> \n#> MSE:  0.08641811\n#> RMSE:  0.2939696\n#> LogLoss:  0.303241\n#> Mean Per-Class Error:  0.266688\n#> AUC:  0.8319103\n#> AUCPR:  0.5994035\n#> Gini:  0.6638206\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error       Rate\n#> No     864  45 0.049505    =45/909\n#> Yes     75  80 0.483871    =75/155\n#> Totals 939 125 0.112782  =120/1064\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.360682   0.571429 102\n#> 2                       max f2  0.182632   0.642616 191\n#> 3                 max f0point5  0.431276   0.648995  82\n#> 4                 max accuracy  0.431276   0.895677  82\n#> 5                max precision  0.980506   1.000000   0\n#> 6                   max recall  0.001516   1.000000 398\n#> 7              max specificity  0.980506   1.000000   0\n#> 8             max absolute_mcc  0.431276   0.522585  82\n#> 9   max min_per_class_accuracy  0.140175   0.767742 219\n#> 10 max mean_per_class_accuracy  0.182632   0.783584 191\n#> 11                     max tns  0.980506 909.000000   0\n#> 12                     max fns  0.980506 154.000000   0\n#> 13                     max fps  0.000914 909.000000 399\n#> 14                     max tps  0.001516 155.000000 398\n#> 15                     max tnr  0.980506   1.000000   0\n#> 16                     max fnr  0.980506   0.993548   0\n#> 17                     max fpr  0.000914   1.000000 399\n#> 18                     max tpr  0.001516   1.000000 398\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> Cross-Validation Metrics Summary: \n#>                mean       sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid\n#> accuracy   0.880984 0.040143   0.822967   0.895735   0.888372   0.866029\n#> auc        0.842685 0.064392   0.806568   0.863082   0.763964   0.844034\n#> err        0.119016 0.040143   0.177034   0.104265   0.111628   0.133971\n#> err_count 25.200000 8.105554  37.000000  22.000000  24.000000  28.000000\n#> f0point5   0.606981 0.053175   0.530612   0.650406   0.593220   0.596330\n#>           cv_5_valid\n#> accuracy    0.931818\n#> auc         0.935776\n#> err         0.068182\n#> err_count  15.000000\n#> f0point5    0.664336\n#> \n#> ---\n#>                         mean        sd cv_1_valid cv_2_valid cv_3_valid\n#> precision           0.606113  0.075176   0.500000   0.695652   0.636364\n#> r2                  0.302686  0.052168   0.236298   0.329707   0.257638\n#> recall              0.655258  0.156793   0.702703   0.516129   0.466667\n#> residual_deviance 128.898620 21.671938 154.485930 120.362076 140.227260\n#> rmse                0.293594  0.030029   0.333565   0.289846   0.298549\n#> specificity         0.919316  0.049655   0.848837   0.961111   0.956757\n#>                   cv_4_valid cv_5_valid\n#> precision           0.565217   0.633333\n#> r2                  0.353729   0.336059\n#> recall              0.764706   0.826087\n#> residual_deviance 132.316830  97.101036\n#> rmse                0.296701   0.249310\n#> specificity         0.885714   0.944162\n```\n:::\n:::\n\n# Depending on the algorithm, the output will be different\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-32_97158cc81d581960afbcb829b205d285'}\n\n```{.r .cell-code}\n#h2o.getModel(\"C:/Users/tiend/Documents/GitHub/ss23-bdml-tiend96/content/01_journal/Challenge4/04_Modeling/h20_models/DeepLearning_1_AutoML_1_20230524_195722\")\n\n# Extracts and H2O model name by a position so can more easily use h2o.getModel()\nsource(\"extract_h2o_model_name_by_position.R\")\n\nautoml_models_h2o@leaderboard %>% \n  extract_h2o_model_name_by_position(6) %>% \n  h2o.getModel()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> StackedEnsemble_AllModels_1_AutoML_1_20230530_171852\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Model Details:\n#> ==============\n#> \n#> H2OBinomialModel: stackedensemble\n#> Model ID:  StackedEnsemble_AllModels_1_AutoML_1_20230530_171852 \n#> Model Summary for Stacked Ensemble: \n#>                                     key            value\n#> 1                     Stacking strategy cross_validation\n#> 2  Number of base models (used / total)              3/6\n#> 3      # GBM base models (used / total)              2/4\n#> 4      # GLM base models (used / total)              1/1\n#> 5      # DRF base models (used / total)              0/1\n#> 6                 Metalearner algorithm              GLM\n#> 7    Metalearner fold assignment scheme           Random\n#> 8                    Metalearner nfolds                5\n#> 9               Metalearner fold_column               NA\n#> 10   Custom metalearner hyperparameters             None\n#> \n#> \n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on training data. **\n#> \n#> MSE:  0.06902539\n#> RMSE:  0.2627268\n#> LogLoss:  0.2472806\n#> Mean Per-Class Error:  0.1576351\n#> AUC:  0.9045495\n#> AUCPR:  0.7728257\n#> Gini:  0.809099\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error      Rate\n#> No     857  52 0.057206   =52/909\n#> Yes     40 115 0.258065   =40/155\n#> Totals 897 167 0.086466  =92/1064\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.288046   0.714286 134\n#> 2                       max f2  0.221560   0.739857 166\n#> 3                 max f0point5  0.469695   0.780347  76\n#> 4                 max accuracy  0.412249   0.921992  92\n#> 5                max precision  0.953004   1.000000   0\n#> 6                   max recall  0.003100   1.000000 396\n#> 7              max specificity  0.953004   1.000000   0\n#> 8             max absolute_mcc  0.288046   0.664068 134\n#> 9   max min_per_class_accuracy  0.174535   0.832258 199\n#> 10 max mean_per_class_accuracy  0.221560   0.848295 166\n#> 11                     max tns  0.953004 909.000000   0\n#> 12                     max fns  0.953004 154.000000   0\n#> 13                     max fps  0.000722 909.000000 399\n#> 14                     max tps  0.003100 155.000000 396\n#> 15                     max tnr  0.953004   1.000000   0\n#> 16                     max fnr  0.953004   0.993548   0\n#> 17                     max fpr  0.000722   1.000000 399\n#> 18                     max tpr  0.003100   1.000000 396\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on validation data. **\n#> \n#> MSE:  0.1030464\n#> RMSE:  0.3210084\n#> LogLoss:  0.3390758\n#> Mean Per-Class Error:  0.1855532\n#> AUC:  0.8664518\n#> AUCPR:  0.7272119\n#> Gini:  0.7329037\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error     Rate\n#> No     135  12 0.081633  =12/147\n#> Yes     11  27 0.289474   =11/38\n#> Totals 146  39 0.124324  =23/185\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.311576   0.701299  38\n#> 2                       max f2  0.220310   0.707317  52\n#> 3                 max f0point5  0.516807   0.744681  13\n#> 4                 max accuracy  0.318472   0.875676  36\n#> 5                max precision  0.889762   1.000000   0\n#> 6                   max recall  0.019714   1.000000 144\n#> 7              max specificity  0.889762   1.000000   0\n#> 8             max absolute_mcc  0.311576   0.622901  38\n#> 9   max min_per_class_accuracy  0.220310   0.763158  52\n#> 10 max mean_per_class_accuracy  0.311576   0.814447  38\n#> 11                     max tns  0.889762 147.000000   0\n#> 12                     max fns  0.889762  37.000000   0\n#> 13                     max fps  0.001539 147.000000 184\n#> 14                     max tps  0.019714  38.000000 144\n#> 15                     max tnr  0.889762   1.000000   0\n#> 16                     max fnr  0.889762   0.973684   0\n#> 17                     max fpr  0.001539   1.000000 184\n#> 18                     max tpr  0.019714   1.000000 144\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on cross-validation data. **\n#> ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **\n#> \n#> MSE:  0.08634616\n#> RMSE:  0.2938472\n#> LogLoss:  0.3022451\n#> Mean Per-Class Error:  0.2059938\n#> AUC:  0.8423294\n#> AUCPR:  0.606285\n#> Gini:  0.6846588\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error       Rate\n#> No     816  93 0.102310    =93/909\n#> Yes     48 107 0.309677    =48/155\n#> Totals 864 200 0.132519  =141/1064\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.249292   0.602817 140\n#> 2                       max f2  0.249292   0.652439 140\n#> 3                 max f0point5  0.385164   0.651438  86\n#> 4                 max accuracy  0.385164   0.896617  86\n#> 5                max precision  0.955978   1.000000   0\n#> 6                   max recall  0.000656   1.000000 399\n#> 7              max specificity  0.955978   1.000000   0\n#> 8             max absolute_mcc  0.381661   0.538870  87\n#> 9   max min_per_class_accuracy  0.155058   0.768977 205\n#> 10 max mean_per_class_accuracy  0.249292   0.794006 140\n#> 11                     max tns  0.955978 909.000000   0\n#> 12                     max fns  0.955978 154.000000   0\n#> 13                     max fps  0.000656 909.000000 399\n#> 14                     max tps  0.000656 155.000000 399\n#> 15                     max tnr  0.955978   1.000000   0\n#> 16                     max fnr  0.955978   0.993548   0\n#> 17                     max fpr  0.000656   1.000000 399\n#> 18                     max tpr  0.000656   1.000000 399\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> Cross-Validation Metrics Summary: \n#>                mean       sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid\n#> accuracy   0.890996 0.033969   0.847619   0.914286   0.933649   0.887387\n#> auc        0.840764 0.035545   0.845254   0.896490   0.842356   0.807072\n#> err        0.109004 0.033969   0.152381   0.085714   0.066351   0.112613\n#> err_count 23.200000 7.190271  32.000000  18.000000  14.000000  25.000000\n#> f0point5   0.633145 0.086902   0.596708   0.754717   0.679012   0.608974\n#>           cv_5_valid\n#> accuracy    0.872038\n#> auc         0.812646\n#> err         0.127962\n#> err_count  27.000000\n#> f0point5    0.526316\n#> \n#> ---\n#>                         mean        sd cv_1_valid cv_2_valid cv_3_valid\n#> precision           0.641037  0.109414   0.568627   0.774193   0.733333\n#> r2                  0.305598  0.070137   0.342609   0.410932   0.275583\n#> recall              0.623658  0.089200   0.743590   0.685714   0.523810\n#> residual_deviance 127.237305 16.260708 143.665540 115.783060 106.459045\n#> rmse                0.290866  0.022949   0.315299   0.286033   0.254799\n#> specificity         0.933033  0.041474   0.871345   0.960000   0.978947\n#>                   cv_4_valid cv_5_valid\n#> precision           0.612903   0.516129\n#> r2                  0.250398   0.248470\n#> recall              0.593750   0.571429\n#> residual_deviance 142.208100 128.070770\n#> rmse                0.304098   0.294100\n#> specificity         0.936842   0.918033\n```\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-33_5daf29ca9e903e47de4840647aca39b7'}\n\n```{.r .cell-code}\n#h2o.getModel(\"DeepLearning_1_AutoML_1_20230524_195722\") %>% \n#  h2o.saveModel(path = \"04_Modeling/h20_models/\")\n\n#h2o.loadModel(\"04_Modeling/h20_models/DRF_1_AutoML_1_20230523_214315\")\n```\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-34_51b30b15609738a3bc49e1f9eaaf27b4'}\n\n```{.r .cell-code}\n# Choose whatever model you want\nstacked_ensemble_h2o <- h2o.loadModel(\"DeepLearning_1_AutoML_1_20230524_195722\")\nstacked_ensemble_h2o\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Model Details:\n#> ==============\n#> \n#> H2OBinomialModel: deeplearning\n#> Model ID:  DeepLearning_1_AutoML_1_20230524_195722 \n#> Status of Neuron Layers: predicting Attrition, 2-class classification, bernoulli distribution, CrossEntropy loss, 1.202 weights/biases, 25,7 KB, 11.998 training samples, mini-batch size 1\n#>   layer units      type dropout       l1       l2 mean_rate rate_rms momentum\n#> 1     1    95     Input  0.00 %       NA       NA        NA       NA       NA\n#> 2     2    10 Rectifier  0.00 % 0.000000 0.000000  0.170604 0.383497 0.000000\n#> 3     3    10 Rectifier  0.00 % 0.000000 0.000000  0.001880 0.001938 0.000000\n#> 4     4    10 Rectifier  0.00 % 0.000000 0.000000  0.001141 0.001270 0.000000\n#> 5     5     2   Softmax      NA 0.000000 0.000000  0.002060 0.001610 0.000000\n#>   mean_weight weight_rms mean_bias bias_rms\n#> 1          NA         NA        NA       NA\n#> 2   -0.000715   0.136980  0.509535 0.096139\n#> 3    0.012046   0.321003  0.999899 0.071591\n#> 4   -0.025861   0.294297  0.994634 0.048070\n#> 5    0.218097   1.498820 -0.001475 0.055308\n#> \n#> \n#> H2OBinomialMetrics: deeplearning\n#> ** Reported on training data. **\n#> ** Metrics reported on full training frame **\n#> \n#> MSE:  0.06692099\n#> RMSE:  0.2586909\n#> LogLoss:  0.239369\n#> Mean Per-Class Error:  0.1758153\n#> AUC:  0.8989176\n#> AUCPR:  0.7409045\n#> Gini:  0.7978353\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error      Rate\n#> No     865  44 0.048405   =44/909\n#> Yes     47 108 0.303226   =47/155\n#> Totals 912 152 0.085526  =91/1064\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.333843   0.703583 133\n#> 2                       max f2  0.208831   0.705813 184\n#> 3                 max f0point5  0.520297   0.747748  88\n#> 4                 max accuracy  0.429840   0.918233  99\n#> 5                max precision  0.997492   1.000000   0\n#> 6                   max recall  0.002427   1.000000 395\n#> 7              max specificity  0.997492   1.000000   0\n#> 8             max absolute_mcc  0.333843   0.653659 133\n#> 9   max min_per_class_accuracy  0.145989   0.812903 219\n#> 10 max mean_per_class_accuracy  0.208831   0.826665 184\n#> 11                     max tns  0.997492 909.000000   0\n#> 12                     max fns  0.997492 154.000000   0\n#> 13                     max fps  0.000622 909.000000 399\n#> 14                     max tps  0.002427 155.000000 395\n#> 15                     max tnr  0.997492   1.000000   0\n#> 16                     max fnr  0.997492   0.993548   0\n#> 17                     max fpr  0.000622   1.000000 399\n#> 18                     max tpr  0.002427   1.000000 395\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: deeplearning\n#> ** Reported on validation data. **\n#> ** Metrics reported on full validation frame **\n#> \n#> MSE:  0.1026735\n#> RMSE:  0.320427\n#> LogLoss:  0.3369246\n#> Mean Per-Class Error:  0.211869\n#> AUC:  0.867526\n#> AUCPR:  0.7008473\n#> Gini:  0.7350519\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error     Rate\n#> No     135  12 0.081633  =12/147\n#> Yes     13  25 0.342105   =13/38\n#> Totals 148  37 0.135135  =25/185\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.364261   0.666667  36\n#> 2                       max f2  0.134723   0.750000  67\n#> 3                 max f0point5  0.414085   0.696203  29\n#> 4                 max accuracy  0.414085   0.870270  29\n#> 5                max precision  0.994919   1.000000   0\n#> 6                   max recall  0.009348   1.000000 160\n#> 7              max specificity  0.994919   1.000000   0\n#> 8             max absolute_mcc  0.364261   0.582021  36\n#> 9   max min_per_class_accuracy  0.188734   0.789474  58\n#> 10 max mean_per_class_accuracy  0.134723   0.815163  67\n#> 11                     max tns  0.994919 147.000000   0\n#> 12                     max fns  0.994919  37.000000   0\n#> 13                     max fps  0.001045 147.000000 184\n#> 14                     max tps  0.009348  38.000000 160\n#> 15                     max tnr  0.994919   1.000000   0\n#> 16                     max fnr  0.994919   0.973684   0\n#> 17                     max fpr  0.001045   1.000000 184\n#> 18                     max tpr  0.009348   1.000000 160\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: deeplearning\n#> ** Reported on cross-validation data. **\n#> ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **\n#> \n#> MSE:  0.09848229\n#> RMSE:  0.3138189\n#> LogLoss:  0.3390082\n#> Mean Per-Class Error:  0.2860144\n#> AUC:  0.7930871\n#> AUCPR:  0.4844503\n#> Gini:  0.5861741\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>         No Yes    Error       Rate\n#> No     823  86 0.094609    =86/909\n#> Yes     74  81 0.477419    =74/155\n#> Totals 897 167 0.150376  =160/1064\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold      value idx\n#> 1                       max f1  0.253595   0.503106 130\n#> 2                       max f2  0.109777   0.577889 232\n#> 3                 max f0point5  0.428265   0.551102  72\n#> 4                 max accuracy  0.487139   0.878759  54\n#> 5                max precision  0.976322   1.000000   0\n#> 6                   max recall  0.006325   1.000000 388\n#> 7              max specificity  0.976322   1.000000   0\n#> 8             max absolute_mcc  0.277464   0.416306 121\n#> 9   max min_per_class_accuracy  0.115044   0.722581 227\n#> 10 max mean_per_class_accuracy  0.177680   0.736446 171\n#> 11                     max tns  0.976322 909.000000   0\n#> 12                     max fns  0.976322 154.000000   0\n#> 13                     max fps  0.001078 909.000000 399\n#> 14                     max tps  0.006325 155.000000 388\n#> 15                     max tnr  0.976322   1.000000   0\n#> 16                     max fnr  0.976322   0.993548   0\n#> 17                     max fpr  0.001078   1.000000 399\n#> 18                     max tpr  0.006325   1.000000 388\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> Cross-Validation Metrics Summary: \n#>                              mean       sd cv_1_valid cv_2_valid cv_3_valid\n#> accuracy                 0.854332 0.042995   0.784038   0.849765   0.877934\n#> auc                      0.792739 0.029235   0.768366   0.825173   0.788860\n#> err                      0.145668 0.042995   0.215962   0.150235   0.122066\n#> err_count               31.000000 9.165152  46.000000  32.000000  26.000000\n#> f0point5                 0.537624 0.114784   0.364807   0.550459   0.616438\n#> f1                       0.533413 0.068179   0.425000   0.600000   0.580645\n#> f2                       0.547807 0.085503   0.508982   0.659341   0.548781\n#> lift_top_group           4.965196 1.692645   4.896552   4.176471   6.264706\n#> logloss                  0.338977 0.021677   0.363298   0.334220   0.350682\n#> max_per_class_error      0.432354 0.119745   0.413793   0.294118   0.470588\n#> mcc                      0.466691 0.083075   0.322603   0.518896   0.513290\n#> mean_per_class_accuracy  0.735549 0.043726   0.700712   0.791489   0.736773\n#> mean_per_class_error     0.264451 0.043726   0.299288   0.208511   0.263227\n#> mse                      0.098475 0.006824   0.108420   0.099946   0.099735\n#> pr_auc                   0.494855 0.087045   0.374665   0.513816   0.582080\n#> precision                0.554030 0.176659   0.333333   0.521739   0.642857\n#> r2                       0.204180 0.076910   0.078163   0.254940   0.256512\n#> recall                   0.567646 0.119745   0.586207   0.705882   0.529412\n#> rmse                     0.313658 0.010822   0.329272   0.316142   0.315808\n#> specificity              0.903452 0.064388   0.815217   0.877095   0.944134\n#>                         cv_4_valid cv_5_valid\n#> accuracy                  0.896714   0.863208\n#> auc                       0.761078   0.820220\n#> err                       0.103286   0.136792\n#> err_count                22.000000  29.000000\n#> f0point5                  0.659341   0.497076\n#> f1                        0.521739   0.539683\n#> f2                        0.431655   0.590278\n#> lift_top_group            6.870968   2.617284\n#> logloss                   0.341224   0.305459\n#> max_per_class_error       0.612903   0.370370\n#> mcc                       0.510810   0.467854\n#> mean_per_class_accuracy   0.685307   0.763463\n#> mean_per_class_error      0.314693   0.236537\n#> mse                       0.093414   0.090860\n#> pr_auc                    0.564291   0.439422\n#> precision                 0.800000   0.472222\n#> r2                        0.248827   0.182457\n#> recall                    0.387097   0.629630\n#> rmse                      0.305638   0.301431\n#> specificity               0.983516   0.897297\n```\n:::\n\n```{.r .cell-code}\npredictions <- h2o.predict(stacked_ensemble_h2o, newdata = as.h2o(test_tbl))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\ntypeof(predictions)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"environment\"\n```\n:::\n\n```{.r .cell-code}\n## [1] \"environment\"\n\npredictions_tbl <- predictions %>% as_tibble()\n\npredictions_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"predict\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"No\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Yes\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"No\",\"2\":\"0.93853401\",\"3\":\"0.061465992\"},{\"1\":\"No\",\"2\":\"0.78413027\",\"3\":\"0.215869730\"},{\"1\":\"No\",\"2\":\"0.91225216\",\"3\":\"0.087747842\"},{\"1\":\"No\",\"2\":\"0.88638561\",\"3\":\"0.113614389\"},{\"1\":\"No\",\"2\":\"0.98663389\",\"3\":\"0.013366112\"},{\"1\":\"No\",\"2\":\"0.99398434\",\"3\":\"0.006015660\"},{\"1\":\"No\",\"2\":\"0.99561521\",\"3\":\"0.004384787\"},{\"1\":\"Yes\",\"2\":\"0.10982799\",\"3\":\"0.890172010\"},{\"1\":\"Yes\",\"2\":\"0.07982769\",\"3\":\"0.920172310\"},{\"1\":\"No\",\"2\":\"0.99702395\",\"3\":\"0.002976045\"},{\"1\":\"No\",\"2\":\"0.81466519\",\"3\":\"0.185334809\"},{\"1\":\"No\",\"2\":\"0.94931437\",\"3\":\"0.050685633\"},{\"1\":\"No\",\"2\":\"0.96691971\",\"3\":\"0.033080287\"},{\"1\":\"No\",\"2\":\"0.99723269\",\"3\":\"0.002767305\"},{\"1\":\"No\",\"2\":\"0.95103804\",\"3\":\"0.048961960\"},{\"1\":\"No\",\"2\":\"0.87581990\",\"3\":\"0.124180104\"},{\"1\":\"No\",\"2\":\"0.99795290\",\"3\":\"0.002047104\"},{\"1\":\"No\",\"2\":\"0.74955518\",\"3\":\"0.250444821\"},{\"1\":\"No\",\"2\":\"0.94040533\",\"3\":\"0.059594669\"},{\"1\":\"No\",\"2\":\"0.85433141\",\"3\":\"0.145668594\"},{\"1\":\"No\",\"2\":\"0.98045651\",\"3\":\"0.019543486\"},{\"1\":\"Yes\",\"2\":\"0.16749971\",\"3\":\"0.832500291\"},{\"1\":\"No\",\"2\":\"0.95919366\",\"3\":\"0.040806337\"},{\"1\":\"No\",\"2\":\"0.92232466\",\"3\":\"0.077675342\"},{\"1\":\"No\",\"2\":\"0.70569342\",\"3\":\"0.294306579\"},{\"1\":\"No\",\"2\":\"0.97525961\",\"3\":\"0.024740391\"},{\"1\":\"No\",\"2\":\"0.85861117\",\"3\":\"0.141388825\"},{\"1\":\"No\",\"2\":\"0.87724540\",\"3\":\"0.122754598\"},{\"1\":\"No\",\"2\":\"0.98628708\",\"3\":\"0.013712924\"},{\"1\":\"No\",\"2\":\"0.97386246\",\"3\":\"0.026137537\"},{\"1\":\"No\",\"2\":\"0.97141935\",\"3\":\"0.028580646\"},{\"1\":\"No\",\"2\":\"0.98268600\",\"3\":\"0.017314000\"},{\"1\":\"No\",\"2\":\"0.97886458\",\"3\":\"0.021135423\"},{\"1\":\"No\",\"2\":\"0.70011851\",\"3\":\"0.299881493\"},{\"1\":\"No\",\"2\":\"0.98441197\",\"3\":\"0.015588026\"},{\"1\":\"Yes\",\"2\":\"0.27195454\",\"3\":\"0.728045458\"},{\"1\":\"No\",\"2\":\"0.99304640\",\"3\":\"0.006953603\"},{\"1\":\"No\",\"2\":\"0.99794938\",\"3\":\"0.002050622\"},{\"1\":\"No\",\"2\":\"0.92761380\",\"3\":\"0.072386200\"},{\"1\":\"No\",\"2\":\"0.91238294\",\"3\":\"0.087617064\"},{\"1\":\"No\",\"2\":\"0.97386696\",\"3\":\"0.026133036\"},{\"1\":\"No\",\"2\":\"0.99659588\",\"3\":\"0.003404121\"},{\"1\":\"No\",\"2\":\"0.84737287\",\"3\":\"0.152627132\"},{\"1\":\"No\",\"2\":\"0.97620132\",\"3\":\"0.023798676\"},{\"1\":\"No\",\"2\":\"0.92150832\",\"3\":\"0.078491680\"},{\"1\":\"No\",\"2\":\"0.67869728\",\"3\":\"0.321302722\"},{\"1\":\"No\",\"2\":\"0.98887644\",\"3\":\"0.011123557\"},{\"1\":\"No\",\"2\":\"0.93336289\",\"3\":\"0.066637113\"},{\"1\":\"No\",\"2\":\"0.98404649\",\"3\":\"0.015953510\"},{\"1\":\"No\",\"2\":\"0.98460501\",\"3\":\"0.015394992\"},{\"1\":\"No\",\"2\":\"0.98825332\",\"3\":\"0.011746680\"},{\"1\":\"No\",\"2\":\"0.88511267\",\"3\":\"0.114887333\"},{\"1\":\"Yes\",\"2\":\"0.56482814\",\"3\":\"0.435171860\"},{\"1\":\"No\",\"2\":\"0.99231693\",\"3\":\"0.007683073\"},{\"1\":\"No\",\"2\":\"0.95922295\",\"3\":\"0.040777050\"},{\"1\":\"No\",\"2\":\"0.98049345\",\"3\":\"0.019506552\"},{\"1\":\"No\",\"2\":\"0.99346993\",\"3\":\"0.006530068\"},{\"1\":\"No\",\"2\":\"0.96972767\",\"3\":\"0.030272334\"},{\"1\":\"No\",\"2\":\"0.98935591\",\"3\":\"0.010644086\"},{\"1\":\"No\",\"2\":\"0.95536097\",\"3\":\"0.044639026\"},{\"1\":\"No\",\"2\":\"0.87695875\",\"3\":\"0.123041250\"},{\"1\":\"No\",\"2\":\"0.94217007\",\"3\":\"0.057829934\"},{\"1\":\"No\",\"2\":\"0.98794362\",\"3\":\"0.012056376\"},{\"1\":\"No\",\"2\":\"0.95073130\",\"3\":\"0.049268701\"},{\"1\":\"No\",\"2\":\"0.71649921\",\"3\":\"0.283500788\"},{\"1\":\"No\",\"2\":\"0.88979357\",\"3\":\"0.110206434\"},{\"1\":\"No\",\"2\":\"0.96823918\",\"3\":\"0.031760824\"},{\"1\":\"No\",\"2\":\"0.99736008\",\"3\":\"0.002639918\"},{\"1\":\"No\",\"2\":\"0.81008341\",\"3\":\"0.189916590\"},{\"1\":\"No\",\"2\":\"0.98037247\",\"3\":\"0.019627525\"},{\"1\":\"No\",\"2\":\"0.78847785\",\"3\":\"0.211522153\"},{\"1\":\"No\",\"2\":\"0.79376976\",\"3\":\"0.206230244\"},{\"1\":\"No\",\"2\":\"0.85212838\",\"3\":\"0.147871624\"},{\"1\":\"No\",\"2\":\"0.98527461\",\"3\":\"0.014725389\"},{\"1\":\"No\",\"2\":\"0.85630676\",\"3\":\"0.143693237\"},{\"1\":\"No\",\"2\":\"0.99847622\",\"3\":\"0.001523779\"},{\"1\":\"No\",\"2\":\"0.99457927\",\"3\":\"0.005420731\"},{\"1\":\"No\",\"2\":\"0.85132495\",\"3\":\"0.148675046\"},{\"1\":\"No\",\"2\":\"0.97871429\",\"3\":\"0.021285709\"},{\"1\":\"No\",\"2\":\"0.99363589\",\"3\":\"0.006364108\"},{\"1\":\"No\",\"2\":\"0.98991518\",\"3\":\"0.010084815\"},{\"1\":\"No\",\"2\":\"0.99871739\",\"3\":\"0.001282609\"},{\"1\":\"No\",\"2\":\"0.87676755\",\"3\":\"0.123232446\"},{\"1\":\"No\",\"2\":\"0.95974054\",\"3\":\"0.040259463\"},{\"1\":\"No\",\"2\":\"0.97831654\",\"3\":\"0.021683458\"},{\"1\":\"No\",\"2\":\"0.96326797\",\"3\":\"0.036732029\"},{\"1\":\"No\",\"2\":\"0.99233194\",\"3\":\"0.007668055\"},{\"1\":\"No\",\"2\":\"0.96523582\",\"3\":\"0.034764177\"},{\"1\":\"No\",\"2\":\"0.98996433\",\"3\":\"0.010035666\"},{\"1\":\"No\",\"2\":\"0.73595820\",\"3\":\"0.264041798\"},{\"1\":\"Yes\",\"2\":\"0.09400886\",\"3\":\"0.905991144\"},{\"1\":\"No\",\"2\":\"0.99812168\",\"3\":\"0.001878316\"},{\"1\":\"No\",\"2\":\"0.98466513\",\"3\":\"0.015334872\"},{\"1\":\"No\",\"2\":\"0.98218977\",\"3\":\"0.017810231\"},{\"1\":\"No\",\"2\":\"0.92333548\",\"3\":\"0.076664516\"},{\"1\":\"No\",\"2\":\"0.97926074\",\"3\":\"0.020739260\"},{\"1\":\"No\",\"2\":\"0.99402957\",\"3\":\"0.005970427\"},{\"1\":\"No\",\"2\":\"0.85497648\",\"3\":\"0.145023525\"},{\"1\":\"No\",\"2\":\"0.98967656\",\"3\":\"0.010323440\"},{\"1\":\"No\",\"2\":\"0.82334225\",\"3\":\"0.176657747\"},{\"1\":\"No\",\"2\":\"0.98624563\",\"3\":\"0.013754370\"},{\"1\":\"Yes\",\"2\":\"0.59804221\",\"3\":\"0.401957792\"},{\"1\":\"No\",\"2\":\"0.99046396\",\"3\":\"0.009536042\"},{\"1\":\"No\",\"2\":\"0.64543858\",\"3\":\"0.354561417\"},{\"1\":\"No\",\"2\":\"0.86809008\",\"3\":\"0.131909917\"},{\"1\":\"No\",\"2\":\"0.96481808\",\"3\":\"0.035181916\"},{\"1\":\"No\",\"2\":\"0.97600886\",\"3\":\"0.023991144\"},{\"1\":\"No\",\"2\":\"0.87273000\",\"3\":\"0.127269997\"},{\"1\":\"No\",\"2\":\"0.84164638\",\"3\":\"0.158353618\"},{\"1\":\"Yes\",\"2\":\"0.55069597\",\"3\":\"0.449304030\"},{\"1\":\"No\",\"2\":\"0.92322351\",\"3\":\"0.076776490\"},{\"1\":\"Yes\",\"2\":\"0.19850929\",\"3\":\"0.801490714\"},{\"1\":\"No\",\"2\":\"0.76977068\",\"3\":\"0.230229320\"},{\"1\":\"No\",\"2\":\"0.96304308\",\"3\":\"0.036956917\"},{\"1\":\"No\",\"2\":\"0.98748918\",\"3\":\"0.012510823\"},{\"1\":\"No\",\"2\":\"0.97980698\",\"3\":\"0.020193017\"},{\"1\":\"Yes\",\"2\":\"0.18700215\",\"3\":\"0.812997845\"},{\"1\":\"Yes\",\"2\":\"0.23619838\",\"3\":\"0.763801615\"},{\"1\":\"No\",\"2\":\"0.94021887\",\"3\":\"0.059781128\"},{\"1\":\"No\",\"2\":\"0.92490016\",\"3\":\"0.075099837\"},{\"1\":\"No\",\"2\":\"0.99634605\",\"3\":\"0.003653954\"},{\"1\":\"No\",\"2\":\"0.98874303\",\"3\":\"0.011256965\"},{\"1\":\"No\",\"2\":\"0.89899640\",\"3\":\"0.101003605\"},{\"1\":\"Yes\",\"2\":\"0.13937658\",\"3\":\"0.860623423\"},{\"1\":\"No\",\"2\":\"0.98084699\",\"3\":\"0.019153010\"},{\"1\":\"Yes\",\"2\":\"0.35642694\",\"3\":\"0.643573057\"},{\"1\":\"No\",\"2\":\"0.95421658\",\"3\":\"0.045783419\"},{\"1\":\"No\",\"2\":\"0.70624126\",\"3\":\"0.293758739\"},{\"1\":\"No\",\"2\":\"0.68561798\",\"3\":\"0.314382020\"},{\"1\":\"No\",\"2\":\"0.87981698\",\"3\":\"0.120183023\"},{\"1\":\"No\",\"2\":\"0.67579422\",\"3\":\"0.324205783\"},{\"1\":\"No\",\"2\":\"0.99625378\",\"3\":\"0.003746216\"},{\"1\":\"No\",\"2\":\"0.98125196\",\"3\":\"0.018748038\"},{\"1\":\"No\",\"2\":\"0.77075003\",\"3\":\"0.229249973\"},{\"1\":\"No\",\"2\":\"0.96970712\",\"3\":\"0.030292884\"},{\"1\":\"No\",\"2\":\"0.89803069\",\"3\":\"0.101969309\"},{\"1\":\"No\",\"2\":\"0.97522150\",\"3\":\"0.024778496\"},{\"1\":\"No\",\"2\":\"0.80661377\",\"3\":\"0.193386231\"},{\"1\":\"No\",\"2\":\"0.92945022\",\"3\":\"0.070549779\"},{\"1\":\"No\",\"2\":\"0.87856205\",\"3\":\"0.121437948\"},{\"1\":\"Yes\",\"2\":\"0.46811663\",\"3\":\"0.531883371\"},{\"1\":\"No\",\"2\":\"0.93537703\",\"3\":\"0.064622965\"},{\"1\":\"No\",\"2\":\"0.84035604\",\"3\":\"0.159643956\"},{\"1\":\"No\",\"2\":\"0.97434804\",\"3\":\"0.025651962\"},{\"1\":\"Yes\",\"2\":\"0.51698650\",\"3\":\"0.483013496\"},{\"1\":\"No\",\"2\":\"0.99559971\",\"3\":\"0.004400291\"},{\"1\":\"No\",\"2\":\"0.93051072\",\"3\":\"0.069489277\"},{\"1\":\"No\",\"2\":\"0.87540987\",\"3\":\"0.124590134\"},{\"1\":\"Yes\",\"2\":\"0.01141479\",\"3\":\"0.988585206\"},{\"1\":\"No\",\"2\":\"0.84083827\",\"3\":\"0.159161732\"},{\"1\":\"No\",\"2\":\"0.98343836\",\"3\":\"0.016561637\"},{\"1\":\"No\",\"2\":\"0.94345639\",\"3\":\"0.056543609\"},{\"1\":\"Yes\",\"2\":\"0.04746100\",\"3\":\"0.952538996\"},{\"1\":\"No\",\"2\":\"0.97809663\",\"3\":\"0.021903365\"},{\"1\":\"No\",\"2\":\"0.99077228\",\"3\":\"0.009227718\"},{\"1\":\"No\",\"2\":\"0.99064256\",\"3\":\"0.009357441\"},{\"1\":\"No\",\"2\":\"0.91955142\",\"3\":\"0.080448578\"},{\"1\":\"Yes\",\"2\":\"0.56375219\",\"3\":\"0.436247805\"},{\"1\":\"No\",\"2\":\"0.65756185\",\"3\":\"0.342438148\"},{\"1\":\"No\",\"2\":\"0.84901918\",\"3\":\"0.150980822\"},{\"1\":\"No\",\"2\":\"0.96885826\",\"3\":\"0.031141739\"},{\"1\":\"No\",\"2\":\"0.72729981\",\"3\":\"0.272700193\"},{\"1\":\"Yes\",\"2\":\"0.49255350\",\"3\":\"0.507446499\"},{\"1\":\"No\",\"2\":\"0.91308305\",\"3\":\"0.086916954\"},{\"1\":\"No\",\"2\":\"0.95990355\",\"3\":\"0.040096445\"},{\"1\":\"No\",\"2\":\"0.94074813\",\"3\":\"0.059251870\"},{\"1\":\"No\",\"2\":\"0.94134393\",\"3\":\"0.058656073\"},{\"1\":\"Yes\",\"2\":\"0.30050379\",\"3\":\"0.699496213\"},{\"1\":\"No\",\"2\":\"0.92666989\",\"3\":\"0.073330113\"},{\"1\":\"No\",\"2\":\"0.97636119\",\"3\":\"0.023638815\"},{\"1\":\"Yes\",\"2\":\"0.32031173\",\"3\":\"0.679688267\"},{\"1\":\"No\",\"2\":\"0.75055663\",\"3\":\"0.249443374\"},{\"1\":\"No\",\"2\":\"0.67524474\",\"3\":\"0.324755265\"},{\"1\":\"No\",\"2\":\"0.95880103\",\"3\":\"0.041198975\"},{\"1\":\"Yes\",\"2\":\"0.63262663\",\"3\":\"0.367373369\"},{\"1\":\"No\",\"2\":\"0.87853367\",\"3\":\"0.121466330\"},{\"1\":\"No\",\"2\":\"0.98722811\",\"3\":\"0.012771889\"},{\"1\":\"No\",\"2\":\"0.98480689\",\"3\":\"0.015193108\"},{\"1\":\"No\",\"2\":\"0.76221411\",\"3\":\"0.237785895\"},{\"1\":\"No\",\"2\":\"0.93356576\",\"3\":\"0.066434239\"},{\"1\":\"No\",\"2\":\"0.98482650\",\"3\":\"0.015173496\"},{\"1\":\"Yes\",\"2\":\"0.02812417\",\"3\":\"0.971875825\"},{\"1\":\"No\",\"2\":\"0.91579842\",\"3\":\"0.084201579\"},{\"1\":\"No\",\"2\":\"0.99363312\",\"3\":\"0.006366877\"},{\"1\":\"No\",\"2\":\"0.98616781\",\"3\":\"0.013832187\"},{\"1\":\"Yes\",\"2\":\"0.17739333\",\"3\":\"0.822606671\"},{\"1\":\"Yes\",\"2\":\"0.62852012\",\"3\":\"0.371479879\"},{\"1\":\"No\",\"2\":\"0.94955079\",\"3\":\"0.050449211\"},{\"1\":\"No\",\"2\":\"0.71351032\",\"3\":\"0.286489676\"},{\"1\":\"No\",\"2\":\"0.99461589\",\"3\":\"0.005384114\"},{\"1\":\"No\",\"2\":\"0.92970385\",\"3\":\"0.070296147\"},{\"1\":\"No\",\"2\":\"0.93632014\",\"3\":\"0.063679859\"},{\"1\":\"No\",\"2\":\"0.98413694\",\"3\":\"0.015863063\"},{\"1\":\"Yes\",\"2\":\"0.63473003\",\"3\":\"0.365269973\"},{\"1\":\"No\",\"2\":\"0.78232279\",\"3\":\"0.217677208\"},{\"1\":\"No\",\"2\":\"0.64097642\",\"3\":\"0.359023583\"},{\"1\":\"No\",\"2\":\"0.94716468\",\"3\":\"0.052835324\"},{\"1\":\"No\",\"2\":\"0.98460109\",\"3\":\"0.015398914\"},{\"1\":\"No\",\"2\":\"0.84599272\",\"3\":\"0.154007284\"},{\"1\":\"No\",\"2\":\"0.63803615\",\"3\":\"0.361963846\"},{\"1\":\"No\",\"2\":\"0.98028261\",\"3\":\"0.019717387\"},{\"1\":\"No\",\"2\":\"0.98620728\",\"3\":\"0.013792720\"},{\"1\":\"No\",\"2\":\"0.73040245\",\"3\":\"0.269597550\"},{\"1\":\"No\",\"2\":\"0.98313554\",\"3\":\"0.016864461\"},{\"1\":\"No\",\"2\":\"0.91812351\",\"3\":\"0.081876486\"},{\"1\":\"No\",\"2\":\"0.95657273\",\"3\":\"0.043427266\"},{\"1\":\"Yes\",\"2\":\"0.24519919\",\"3\":\"0.754800805\"},{\"1\":\"No\",\"2\":\"0.98188616\",\"3\":\"0.018113842\"},{\"1\":\"No\",\"2\":\"0.97495940\",\"3\":\"0.025040602\"},{\"1\":\"No\",\"2\":\"0.96736086\",\"3\":\"0.032639139\"},{\"1\":\"No\",\"2\":\"0.91404417\",\"3\":\"0.085955826\"},{\"1\":\"No\",\"2\":\"0.76074406\",\"3\":\"0.239255936\"},{\"1\":\"No\",\"2\":\"0.96848149\",\"3\":\"0.031518506\"},{\"1\":\"No\",\"2\":\"0.67955703\",\"3\":\"0.320442966\"},{\"1\":\"No\",\"2\":\"0.99156437\",\"3\":\"0.008435630\"},{\"1\":\"No\",\"2\":\"0.97586292\",\"3\":\"0.024137078\"},{\"1\":\"No\",\"2\":\"0.77043474\",\"3\":\"0.229565257\"},{\"1\":\"No\",\"2\":\"0.96015605\",\"3\":\"0.039843946\"},{\"1\":\"No\",\"2\":\"0.89143362\",\"3\":\"0.108566379\"},{\"1\":\"No\",\"2\":\"0.98563642\",\"3\":\"0.014363578\"},{\"1\":\"No\",\"2\":\"0.93733609\",\"3\":\"0.062663913\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-35_c9ddc83f7ee72ebd54a4953051b943c2'}\n\n```{.r .cell-code}\ndeep_learning_h2o <- h2o.loadModel(\"DeepLearning_1_AutoML_1_20230524_195722\")\n\n# To see all possible parameters\n?h2o.deeplearning\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> starte den http Server für die Hilfe fertig\n```\n:::\n\n```{.r .cell-code}\n# to get all paramteres\ndeep_learning_h2o@allparameters\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $model_id\n#> [1] \"DeepLearning_1_AutoML_1_20230524_195722\"\n#> \n#> $nfolds\n#> [1] 5\n#> \n#> $keep_cross_validation_models\n#> [1] FALSE\n#> \n#> $keep_cross_validation_predictions\n#> [1] TRUE\n#> \n#> $keep_cross_validation_fold_assignment\n#> [1] FALSE\n#> \n#> $fold_assignment\n#> [1] \"Modulo\"\n#> \n#> $ignore_const_cols\n#> [1] TRUE\n#> \n#> $score_each_iteration\n#> [1] FALSE\n#> \n#> $balance_classes\n#> [1] FALSE\n#> \n#> $max_after_balance_size\n#> [1] 5\n#> \n#> $max_confusion_matrix_size\n#> [1] 20\n#> \n#> $overwrite_with_best_model\n#> [1] FALSE\n#> \n#> $use_all_factor_levels\n#> [1] TRUE\n#> \n#> $standardize\n#> [1] TRUE\n#> \n#> $activation\n#> [1] \"Rectifier\"\n#> \n#> $hidden\n#> [1] 10 10 10\n#> \n#> $epochs\n#> [1] 10.3602\n#> \n#> $train_samples_per_iteration\n#> [1] -2\n#> \n#> $target_ratio_comm_to_comp\n#> [1] 0.05\n#> \n#> $seed\n#> [1] \"8785999559547214598\"\n#> \n#> $adaptive_rate\n#> [1] TRUE\n#> \n#> $rho\n#> [1] 0.99\n#> \n#> $epsilon\n#> [1] 1e-08\n#> \n#> $rate\n#> [1] 0.005\n#> \n#> $rate_annealing\n#> [1] 1e-06\n#> \n#> $rate_decay\n#> [1] 1\n#> \n#> $momentum_start\n#> [1] 0\n#> \n#> $momentum_ramp\n#> [1] 1e+06\n#> \n#> $momentum_stable\n#> [1] 0\n#> \n#> $nesterov_accelerated_gradient\n#> [1] TRUE\n#> \n#> $input_dropout_ratio\n#> [1] 0\n#> \n#> $l1\n#> [1] 0\n#> \n#> $l2\n#> [1] 0\n#> \n#> $max_w2\n#> [1] 3.402823e+38\n#> \n#> $initial_weight_distribution\n#> [1] \"UniformAdaptive\"\n#> \n#> $initial_weight_scale\n#> [1] 1\n#> \n#> $loss\n#> [1] \"Automatic\"\n#> \n#> $distribution\n#> [1] \"bernoulli\"\n#> \n#> $quantile_alpha\n#> [1] 0.5\n#> \n#> $tweedie_power\n#> [1] 1.5\n#> \n#> $huber_alpha\n#> [1] 0.9\n#> \n#> $score_interval\n#> [1] 5\n#> \n#> $score_training_samples\n#> [1] 10000\n#> \n#> $score_validation_samples\n#> [1] 0\n#> \n#> $score_duty_cycle\n#> [1] 0.1\n#> \n#> $classification_stop\n#> [1] 0\n#> \n#> $regression_stop\n#> [1] 1e-06\n#> \n#> $stopping_rounds\n#> [1] 0\n#> \n#> $stopping_metric\n#> [1] \"logloss\"\n#> \n#> $stopping_tolerance\n#> [1] 0.03065697\n#> \n#> $max_runtime_secs\n#> [1] 10.584\n#> \n#> $score_validation_sampling\n#> [1] \"Uniform\"\n#> \n#> $diagnostics\n#> [1] TRUE\n#> \n#> $fast_mode\n#> [1] TRUE\n#> \n#> $force_load_balance\n#> [1] TRUE\n#> \n#> $variable_importances\n#> [1] TRUE\n#> \n#> $replicate_training_data\n#> [1] TRUE\n#> \n#> $single_node_mode\n#> [1] FALSE\n#> \n#> $shuffle_training_data\n#> [1] FALSE\n#> \n#> $missing_values_handling\n#> [1] \"MeanImputation\"\n#> \n#> $quiet_mode\n#> [1] FALSE\n#> \n#> $autoencoder\n#> [1] FALSE\n#> \n#> $sparse\n#> [1] FALSE\n#> \n#> $col_major\n#> [1] FALSE\n#> \n#> $average_activation\n#> [1] 0\n#> \n#> $sparsity_beta\n#> [1] 0\n#> \n#> $max_categorical_features\n#> [1] 2147483647\n#> \n#> $reproducible\n#> [1] FALSE\n#> \n#> $export_weights_and_biases\n#> [1] FALSE\n#> \n#> $mini_batch_size\n#> [1] 1\n#> \n#> $categorical_encoding\n#> [1] \"OneHotInternal\"\n#> \n#> $elastic_averaging\n#> [1] FALSE\n#> \n#> $elastic_averaging_moving_rate\n#> [1] 0.9\n#> \n#> $elastic_averaging_regularization\n#> [1] 0.001\n#> \n#> $auc_type\n#> [1] \"AUTO\"\n#> \n#> $x\n#>  [1] \"JobRole\"                  \"EducationField\"          \n#>  [3] \"JobLevel\"                 \"Education\"               \n#>  [5] \"EnvironmentSatisfaction\"  \"JobInvolvement\"          \n#>  [7] \"JobSatisfaction\"          \"RelationshipSatisfaction\"\n#>  [9] \"StockOptionLevel\"         \"WorkLifeBalance\"         \n#> [11] \"Department\"               \"BusinessTravel\"          \n#> [13] \"MaritalStatus\"            \"Gender\"                  \n#> [15] \"OverTime\"                 \"PerformanceRating\"       \n#> [17] \"Age\"                      \"DailyRate\"               \n#> [19] \"DistanceFromHome\"         \"EmployeeNumber\"          \n#> [21] \"HourlyRate\"               \"MonthlyIncome\"           \n#> [23] \"MonthlyRate\"              \"NumCompaniesWorked\"      \n#> [25] \"PercentSalaryHike\"        \"TotalWorkingYears\"       \n#> [27] \"TrainingTimesLastYear\"    \"YearsAtCompany\"          \n#> [29] \"YearsInCurrentRole\"       \"YearsSinceLastPromotion\" \n#> [31] \"YearsWithCurrManager\"    \n#> \n#> $y\n#> [1] \"Attrition\"\n```\n:::\n:::\n\n# Challenge 4 ----------------------------------------------------\n## 1. Load the training & test dataset\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-36_cf0f6d39f7f2689d1242ce8c5bb8cc89'}\n\n```{.r .cell-code}\nproduct_backorder_tbl          <- read_csv(\"product_backorders.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Rows: 19053 Columns: 23\n#> ── Column specification ────────────────────────────────────────────────────────\n#> Delimiter: \",\"\n#> chr  (7): potential_issue, deck_risk, oe_constraint, ppap_risk, stop_auto_bu...\n#> dbl (16): sku, national_inv, lead_time, in_transit_qty, forecast_3_month, fo...\n#> \n#> ℹ Use `spec()` to retrieve the full column specification for this data.\n#> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n## 2. Specifiy the response and predictor variables\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-37_0884aa0483f1f8a69159d791969d93fe'}\n\n```{.r .cell-code}\nset.seed(seed = 1113)\nsplit_obj                       <- rsample::initial_split(product_backorder_tbl, prop = 0.85)\ntrain_readable_tbl              <- training(split_obj)\ntest_readable_tbl               <- testing(split_obj)\n\nrecipe_obj <- recipe(went_on_backorder ~., data = train_readable_tbl) %>% \n    step_zv(all_predictors()) %>% \n    prep()\n\ntrain_tbl <- bake(recipe_obj, new_data = train_readable_tbl)\ntest_tbl  <- bake(recipe_obj, new_data = test_readable_tbl)\n```\n:::\n\n## Modeling\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-38_14ab36d482e05bbae47598ec9557ba89'}\n\n```{.r .cell-code}\nh2o.init()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  Connection successful!\n#> \n#> R is connected to the H2O cluster: \n#>     H2O cluster uptime:         8 minutes 7 seconds \n#>     H2O cluster timezone:       Europe/Berlin \n#>     H2O data parsing timezone:  UTC \n#>     H2O cluster version:        3.40.0.1 \n#>     H2O cluster version age:    3 months and 21 days \n#>     H2O cluster name:           H2O_started_from_R_tiend_htd163 \n#>     H2O cluster total nodes:    1 \n#>     H2O cluster total memory:   3.93 GB \n#>     H2O cluster total cores:    12 \n#>     H2O cluster allowed cores:  12 \n#>     H2O cluster healthy:        TRUE \n#>     H2O Connection ip:          localhost \n#>     H2O Connection port:        54321 \n#>     H2O Connection proxy:       NA \n#>     H2O Internal Security:      FALSE \n#>     R Version:                  R version 4.2.3 (2023-03-15 ucrt)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in h2o.clusterInfo(): \n#> Your H2O cluster version is (3 months and 21 days) old. There may be a newer version available.\n#> Please download and install the latest version from: https://h2o-release.s3.amazonaws.com/h2o/latest_stable.html\n```\n:::\n\n```{.r .cell-code}\n# Split data into a training and a validation data frame\n# Setting the seed is just for reproducability\nsplit_h2o <- h2o.splitFrame(as.h2o(train_tbl), ratios = c(0.85), seed = 1234)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\ntrain_h2o <- split_h2o[[1]]\nvalid_h2o <- split_h2o[[2]]\ntest_h2o  <- as.h2o(test_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\n# Set the target and predictors\ny <- \"went_on_backorder\"\nx <- setdiff(names(train_h2o), y)\n```\n:::\n\n## 3. Run AutoML specifying the stopping criterion\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-39_efd77d57e9a88c774d87b5e4ac16a89a'}\n\n```{.r .cell-code}\nautoml_models_h2o <- h2o.automl(\n  x = x,\n  y = y,\n  training_frame    = train_h2o,\n  validation_frame  = valid_h2o,\n  leaderboard_frame = test_h2o,\n  max_runtime_secs  = 30,\n  nfolds            = 5 \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |==                                                                    |   3%\n#> 17:19:48.634: User specified a validation frame with cross-validation still enabled. Please note that the models will still be validated using cross-validation only, the validation frame will be used to provide purely informative validation metrics on the trained models.\n#> 17:19:48.637: AutoML: XGBoost is not available; skipping it.\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n## 4. View the leaderboard\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-40_8a4ff2d70e20413e99ab8a59b0b66c41'}\n\n```{.r .cell-code}\ntypeof(automl_models_h2o)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"S4\"\n```\n:::\n\n```{.r .cell-code}\n## \"S4\"\n\nslotNames(automl_models_h2o)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"project_name\"   \"leader\"         \"leaderboard\"    \"event_log\"     \n#> [5] \"modeling_steps\" \"training_info\"\n```\n:::\n\n```{.r .cell-code}\n## [1] \"project_name\"   \"leader\"         \"leaderboard\"    \"event_log\"      \"modeling_steps\" \"training_info\" \n\nautoml_models_h2o@leaderboard\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                                                  model_id       auc   logloss\n#> 1 StackedEnsemble_BestOfFamily_3_AutoML_2_20230530_171948 0.9505346 0.1737436\n#> 2    StackedEnsemble_AllModels_2_AutoML_2_20230530_171948 0.9504264 0.1743102\n#> 3    StackedEnsemble_AllModels_1_AutoML_2_20230530_171948 0.9497656 0.1748509\n#> 4 StackedEnsemble_BestOfFamily_2_AutoML_2_20230530_171948 0.9495534 0.1746771\n#> 5                          GBM_4_AutoML_2_20230530_171948 0.9491389 0.1771911\n#> 6                          GBM_2_AutoML_2_20230530_171948 0.9461516 0.1818330\n#>       aucpr mean_per_class_error      rmse        mse\n#> 1 0.7473453            0.1416139 0.2284028 0.05216786\n#> 2 0.7456369            0.1398390 0.2294578 0.05265090\n#> 3 0.7458891            0.1400992 0.2295994 0.05271588\n#> 4 0.7465168            0.1455766 0.2286653 0.05228784\n#> 5 0.7459758            0.1519872 0.2301827 0.05298410\n#> 6 0.7322194            0.1442607 0.2326821 0.05414098\n#> \n#> [14 rows x 7 columns]\n```\n:::\n\n```{.r .cell-code}\n##                                              model_id       auc   logloss     aucpr mean_per_class_error      rmse        mse\n## 1 StackedEnsemble_BestOfFamily_AutoML_20200820_190823 0.8585439 0.2992854 0.5869929            0.2406915 0.2978416 0.08870964\n## 2          GBM_grid__1_AutoML_20200820_190823_model_3 0.8494016 0.3137896 0.5165541            0.2386968 0.3098134 0.09598435\n## 3 DeepLearning_grid__1_AutoML_20200820_190823_model_1 0.8479056 0.3066365 0.6154288            0.2583112 0.3071528 0.09434283\n## 4      XGBoost_grid__1_AutoML_20200820_190823_model_5 0.8439162 0.3057109 0.5299331            0.2061170 0.3071419 0.09433613\n## 5    StackedEnsemble_AllModels_AutoML_20200820_190823 0.8425864 0.3211612 0.5205591            0.2539894 0.3107399 0.09655928\n## 6      XGBoost_grid__1_AutoML_20200820_190823_model_6 0.8257979 0.3211936 0.5009608            0.2536569 0.3111129 0.09679122\n##\n## [30 rows x 7 columns] \n\nautoml_models_h2o@leader\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Model Details:\n#> ==============\n#> \n#> H2OBinomialModel: stackedensemble\n#> Model ID:  StackedEnsemble_BestOfFamily_3_AutoML_2_20230530_171948 \n#> Model Summary for Stacked Ensemble: \n#>                                          key            value\n#> 1                          Stacking strategy cross_validation\n#> 2       Number of base models (used / total)              4/5\n#> 3           # GBM base models (used / total)              1/1\n#> 4           # DRF base models (used / total)              2/2\n#> 5           # GLM base models (used / total)              1/1\n#> 6  # DeepLearning base models (used / total)              0/1\n#> 7                      Metalearner algorithm              GLM\n#> 8         Metalearner fold assignment scheme           Random\n#> 9                         Metalearner nfolds                5\n#> 10                   Metalearner fold_column               NA\n#> 11        Custom metalearner hyperparameters             None\n#> \n#> \n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on training data. **\n#> \n#> MSE:  0.02054818\n#> RMSE:  0.1433464\n#> LogLoss:  0.08107618\n#> Mean Per-Class Error:  0.06990433\n#> AUC:  0.9938292\n#> AUCPR:  0.9633379\n#> Gini:  0.9876584\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>          No  Yes    Error        Rate\n#> No     8772   74 0.008365    =74/8846\n#> Yes     153 1011 0.131443   =153/1164\n#> Totals 8925 1085 0.022677  =227/10010\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold       value idx\n#> 1                       max f1  0.484917    0.899066 158\n#> 2                       max f2  0.316263    0.915022 207\n#> 3                 max f0point5  0.615807    0.924437 127\n#> 4                 max accuracy  0.484917    0.977323 158\n#> 5                max precision  0.999648    1.000000   0\n#> 6                   max recall  0.036393    1.000000 332\n#> 7              max specificity  0.999648    1.000000   0\n#> 8             max absolute_mcc  0.484917    0.887005 158\n#> 9   max min_per_class_accuracy  0.224396    0.957495 236\n#> 10 max mean_per_class_accuracy  0.258559    0.959372 225\n#> 11                     max tns  0.999648 8846.000000   0\n#> 12                     max fns  0.999648 1163.000000   0\n#> 13                     max fps  0.000130 8846.000000 399\n#> 14                     max tps  0.036393 1164.000000 332\n#> 15                     max tnr  0.999648    1.000000   0\n#> 16                     max fnr  0.999648    0.999141   0\n#> 17                     max fpr  0.000130    1.000000 399\n#> 18                     max tpr  0.036393    1.000000 332\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on validation data. **\n#> \n#> MSE:  0.04883593\n#> RMSE:  0.2209885\n#> LogLoss:  0.1635604\n#> Mean Per-Class Error:  0.11121\n#> AUC:  0.9548621\n#> AUCPR:  0.7749467\n#> Gini:  0.9097243\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>          No Yes    Error       Rate\n#> No     1962 142 0.067490  =142/2104\n#> Yes      44 240 0.154930    =44/284\n#> Totals 2006 382 0.077889  =186/2388\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold       value idx\n#> 1                       max f1  0.213240    0.720721 216\n#> 2                       max f2  0.181262    0.794574 231\n#> 3                 max f0point5  0.685374    0.748945  92\n#> 4                 max accuracy  0.502370    0.935092 131\n#> 5                max precision  0.974913    1.000000   0\n#> 6                   max recall  0.001056    1.000000 396\n#> 7              max specificity  0.974913    1.000000   0\n#> 8             max absolute_mcc  0.213240    0.686641 216\n#> 9   max min_per_class_accuracy  0.123432    0.893536 259\n#> 10 max mean_per_class_accuracy  0.108938    0.898952 268\n#> 11                     max tns  0.974913 2104.000000   0\n#> 12                     max fns  0.974913  283.000000   0\n#> 13                     max fps  0.000139 2104.000000 399\n#> 14                     max tps  0.001056  284.000000 396\n#> 15                     max tnr  0.974913    1.000000   0\n#> 16                     max fnr  0.974913    0.996479   0\n#> 17                     max fpr  0.000139    1.000000 399\n#> 18                     max tpr  0.001056    1.000000 396\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: stackedensemble\n#> ** Reported on cross-validation data. **\n#> ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **\n#> \n#> MSE:  0.05055507\n#> RMSE:  0.2248445\n#> LogLoss:  0.1706878\n#> Mean Per-Class Error:  0.1433012\n#> AUC:  0.9518013\n#> AUCPR:  0.7386671\n#> Gini:  0.9036025\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>           No  Yes    Error         Rate\n#> No     11549  620 0.050949   =620/12169\n#> Yes      386 1252 0.235653    =386/1638\n#> Totals 11935 1872 0.072862  =1006/13807\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold        value idx\n#> 1                       max f1  0.312093     0.713390 213\n#> 2                       max f2  0.140938     0.775459 275\n#> 3                 max f0point5  0.521195     0.729439 146\n#> 4                 max accuracy  0.521195     0.931846 146\n#> 5                max precision  0.984104     1.000000   0\n#> 6                   max recall  0.000199     1.000000 399\n#> 7              max specificity  0.984104     1.000000   0\n#> 8             max absolute_mcc  0.312093     0.673832 213\n#> 9   max min_per_class_accuracy  0.116669     0.884132 288\n#> 10 max mean_per_class_accuracy  0.092947     0.888155 301\n#> 11                     max tns  0.984104 12169.000000   0\n#> 12                     max fns  0.984104  1635.000000   0\n#> 13                     max fps  0.000199 12169.000000 399\n#> 14                     max tps  0.000199  1638.000000 399\n#> 15                     max tnr  0.984104     1.000000   0\n#> 16                     max fnr  0.984104     0.998168   0\n#> 17                     max fpr  0.000199     1.000000 399\n#> 18                     max tpr  0.000199     1.000000 399\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> Cross-Validation Metrics Summary: \n#>                 mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid\n#> accuracy    0.933691  0.004650   0.936681   0.937982   0.928261   0.929028\n#> auc         0.952260  0.003238   0.955320   0.947773   0.952744   0.950307\n#> err         0.066309  0.004650   0.063319   0.062018   0.071739   0.070972\n#> err_count 183.200000 14.618482 174.000000 169.000000 198.000000 200.000000\n#> f0point5    0.720742  0.010939   0.704380   0.722295   0.733896   0.717439\n#>           cv_5_valid\n#> accuracy    0.936502\n#> auc         0.955155\n#> err         0.063498\n#> err_count 175.000000\n#> f0point5    0.725699\n#> \n#> ---\n#>                         mean        sd cv_1_valid cv_2_valid  cv_3_valid\n#> precision           0.723492  0.009172   0.714815   0.722772    0.731579\n#> r2                  0.515232  0.016789   0.492489   0.506611    0.527326\n#> recall              0.710766  0.031044   0.665517   0.720395    0.743316\n#> residual_deviance 942.476560 64.836500 882.500200 915.867900 1016.921450\n#> rmse                0.224683  0.008198   0.218875   0.221138    0.235311\n#> specificity         0.963327  0.005457   0.968674   0.965304    0.957251\n#>                    cv_4_valid cv_5_valid\n#> precision            0.714286   0.734007\n#> r2                   0.514771   0.534966\n#> recall               0.730337   0.694268\n#> residual_deviance 1007.258500 889.834700\n#> rmse                 0.231420   0.216671\n#> specificity          0.957758   0.967649\n```\n:::\n\n```{.r .cell-code}\nsource(\"extract_h2o_model_name_by_position.R\")\n\nmodel <- automl_models_h2o@leaderboard %>% \n  extract_h2o_model_name_by_position(6) %>% \n  h2o.getModel()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> GBM_2_AutoML_2_20230530_171948\n```\n:::\n\n```{.r .cell-code}\nmodel\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Model Details:\n#> ==============\n#> \n#> H2OBinomialModel: gbm\n#> Model ID:  GBM_2_AutoML_2_20230530_171948 \n#> Model Summary: \n#>   number_of_trees number_of_internal_trees model_size_in_bytes min_depth\n#> 1              79                       79               58865         7\n#>   max_depth mean_depth min_leaves max_leaves mean_leaves\n#> 1         7    7.00000         28         87    54.54430\n#> \n#> \n#> H2OBinomialMetrics: gbm\n#> ** Reported on training data. **\n#> \n#> MSE:  0.03693381\n#> RMSE:  0.1921817\n#> LogLoss:  0.1315131\n#> Mean Per-Class Error:  0.1134932\n#> AUC:  0.9770072\n#> AUCPR:  0.8820287\n#> Gini:  0.9540143\n#> R^2:  0.6467729\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>           No  Yes    Error        Rate\n#> No     11799  370 0.030405  =370/12169\n#> Yes      322 1316 0.196581   =322/1638\n#> Totals 12121 1686 0.050120  =692/13807\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold        value idx\n#> 1                       max f1  0.358069     0.791817 194\n#> 2                       max f2  0.168777     0.839282 260\n#> 3                 max f0point5  0.574337     0.836861 128\n#> 4                 max accuracy  0.458721     0.953067 163\n#> 5                max precision  0.990870     1.000000   0\n#> 6                   max recall  0.020975     1.000000 365\n#> 7              max specificity  0.990870     1.000000   0\n#> 8             max absolute_mcc  0.458721     0.764575 163\n#> 9   max min_per_class_accuracy  0.163320     0.921851 263\n#> 10 max mean_per_class_accuracy  0.146505     0.922623 271\n#> 11                     max tns  0.990870 12169.000000   0\n#> 12                     max fns  0.990870  1635.000000   0\n#> 13                     max fps  0.001663 12169.000000 399\n#> 14                     max tps  0.020975  1638.000000 365\n#> 15                     max tnr  0.990870     1.000000   0\n#> 16                     max fnr  0.990870     0.998168   0\n#> 17                     max fpr  0.001663     1.000000 399\n#> 18                     max tpr  0.020975     1.000000 365\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: gbm\n#> ** Reported on validation data. **\n#> \n#> MSE:  0.05128636\n#> RMSE:  0.2264649\n#> LogLoss:  0.1738922\n#> Mean Per-Class Error:  0.167277\n#> AUC:  0.9496666\n#> AUCPR:  0.7478056\n#> Gini:  0.8993333\n#> R^2:  0.5105521\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>          No Yes    Error       Rate\n#> No     2015  89 0.042300   =89/2104\n#> Yes      83 201 0.292254    =83/284\n#> Totals 2098 290 0.072027  =172/2388\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold       value idx\n#> 1                       max f1  0.322531    0.700348 178\n#> 2                       max f2  0.096387    0.788849 275\n#> 3                 max f0point5  0.560464    0.739300 114\n#> 4                 max accuracy  0.517464    0.931323 124\n#> 5                max precision  0.919562    0.950000  12\n#> 6                   max recall  0.005847    1.000000 387\n#> 7              max specificity  0.988848    0.999525   0\n#> 8             max absolute_mcc  0.322531    0.659467 178\n#> 9   max min_per_class_accuracy  0.125340    0.886882 259\n#> 10 max mean_per_class_accuracy  0.096387    0.900819 275\n#> 11                     max tns  0.988848 2103.000000   0\n#> 12                     max fns  0.988848  284.000000   0\n#> 13                     max fps  0.001380 2104.000000 399\n#> 14                     max tps  0.005847  284.000000 387\n#> 15                     max tnr  0.988848    0.999525   0\n#> 16                     max fnr  0.988848    1.000000   0\n#> 17                     max fpr  0.001380    1.000000 399\n#> 18                     max tpr  0.005847    1.000000 387\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> H2OBinomialMetrics: gbm\n#> ** Reported on cross-validation data. **\n#> ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **\n#> \n#> MSE:  0.0528744\n#> RMSE:  0.2299443\n#> LogLoss:  0.1778463\n#> Mean Per-Class Error:  0.1567967\n#> AUC:  0.9477685\n#> AUCPR:  0.7219702\n#> Gini:  0.895537\n#> R^2:  0.4943206\n#> \n#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:\n#>           No  Yes    Error         Rate\n#> No     11540  629 0.051689   =629/12169\n#> Yes      429 1209 0.261905    =429/1638\n#> Totals 11969 1838 0.076628  =1058/13807\n#> \n#> Maximum Metrics: Maximum metrics at their respective thresholds\n#>                         metric threshold        value idx\n#> 1                       max f1  0.311909     0.695627 209\n#> 2                       max f2  0.140433     0.772742 271\n#> 3                 max f0point5  0.550250     0.712464 133\n#> 4                 max accuracy  0.458730     0.927935 163\n#> 5                max precision  0.941922     0.917647  12\n#> 6                   max recall  0.005248     1.000000 390\n#> 7              max specificity  0.990527     0.999836   0\n#> 8             max absolute_mcc  0.210319     0.654543 243\n#> 9   max min_per_class_accuracy  0.118016     0.884005 281\n#> 10 max mean_per_class_accuracy  0.123093     0.885131 278\n#> 11                     max tns  0.990527 12167.000000   0\n#> 12                     max fns  0.990527  1637.000000   0\n#> 13                     max fps  0.001135 12169.000000 399\n#> 14                     max tps  0.005248  1638.000000 390\n#> 15                     max tnr  0.990527     0.999836   0\n#> 16                     max fnr  0.990527     0.999389   0\n#> 17                     max fpr  0.001135     1.000000 399\n#> 18                     max tpr  0.005248     1.000000 390\n#> \n#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`\n#> Cross-Validation Metrics Summary: \n#>                               mean        sd cv_1_valid cv_2_valid cv_3_valid\n#> accuracy                  0.923879  0.007712   0.934106   0.921434   0.913437\n#> auc                       0.947629  0.005585   0.956067   0.950016   0.942757\n#> err                       0.076121  0.007712   0.065894   0.078566   0.086563\n#> err_count               210.200000 21.276749 182.000000 217.000000 239.000000\n#> f0point5                  0.674673  0.045738   0.745614   0.642154   0.630631\n#> f1                        0.704026  0.025595   0.749311   0.695652   0.690013\n#> f2                        0.738167  0.027362   0.753045   0.758874   0.761741\n#> lift_top_group            7.223031  0.206073   7.398214   7.390181   6.978352\n#> logloss                   0.177847  0.006413   0.173788   0.169361   0.185843\n#> max_per_class_error       0.235707  0.047688   0.244444   0.192182   0.181538\n#> mcc                       0.665015  0.026497   0.711414   0.659935   0.651993\n#> mean_per_class_accuracy   0.854892  0.018180   0.858211   0.871730   0.872285\n#> mean_per_class_error      0.145108  0.018180   0.141789   0.128270   0.127715\n#> mse                       0.052875  0.002157   0.051792   0.050311   0.056156\n#> pr_auc                    0.721481  0.031318   0.772316   0.715135   0.687817\n#> precision                 0.657237  0.059358   0.743169   0.610837   0.596413\n#> r2                        0.493179  0.030582   0.543083   0.490760   0.459285\n#> recall                    0.764293  0.047688   0.755556   0.807818   0.818462\n#> rmse                      0.229907  0.004672   0.227579   0.224302   0.236973\n#> specificity               0.945491  0.014542   0.960866   0.935642   0.926108\n#>                         cv_4_valid cv_5_valid\n#> accuracy                  0.922492   0.927925\n#> auc                       0.942862   0.946445\n#> err                       0.077508   0.072075\n#> err_count               214.000000 199.000000\n#> f0point5                  0.664789   0.690175\n#> f1                        0.688047   0.697108\n#> f2                        0.712991   0.704182\n#> lift_top_group            7.326847   7.021561\n#> logloss                   0.181057   0.179186\n#> max_per_class_error       0.269350   0.291022\n#> mcc                       0.645398   0.656335\n#> mean_per_class_accuracy   0.839279   0.832955\n#> mean_per_class_error      0.160721   0.167045\n#> mse                       0.052918   0.053196\n#> pr_auc                    0.723381   0.708756\n#> precision                 0.650138   0.685629\n#> r2                        0.487733   0.485036\n#> recall                    0.730650   0.708978\n#> rmse                      0.230038   0.230643\n#> specificity               0.947908   0.956932\n```\n:::\n:::\n\n## 5. Predictions\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-41_3675d2e10c153de57ade7bfa72027a80'}\n\n```{.r .cell-code}\npredictions <- h2o.predict(model, newdata = as.h2o(test_tbl))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\npredictions\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>   predict        No       Yes\n#> 1     Yes 0.3393299 0.6606701\n#> 2     Yes 0.3782626 0.6217374\n#> 3     Yes 0.4287946 0.5712054\n#> 4     Yes 0.4445579 0.5554421\n#> 5     Yes 0.2230338 0.7769662\n#> 6     Yes 0.5734233 0.4265767\n#> \n#> [2858 rows x 3 columns]\n```\n:::\n:::\n\n## 6. Save the leader model\n\n::: {.cell hash='Challenge4_cache/html/unnamed-chunk-42_386592529b7281379ab9c08719859e46'}\n\n```{.r .cell-code}\nmodel %>% h2o.saveModel(path = \"04_Modeling/h20_models/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"C:\\\\Users\\\\tiend\\\\Documents\\\\GitHub\\\\ss23-bdml-tiend96\\\\content\\\\01_journal\\\\Challenge3\\\\04_Modeling\\\\h20_models\\\\GBM_2_AutoML_2_20230530_171948\"\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}